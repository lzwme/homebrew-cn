class Kubecolor < Formula
  desc "Colorize your kubectl output"
  homepage "https:kubecolor.github.io"
  url "https:github.comkubecolorkubecolorarchiverefstagsv0.2.2.tar.gz"
  sha256 "ba0894a8e26fefff47a0691529964303bdd8fdc2d7ce74e7d241cb5a2f2ade50"
  license "MIT"

  depends_on "go" => :build
  depends_on "kubernetes-cli" => :test

  def install
    ldflags = "-s -w -X main.Version=v#{version}"

    system "go", "build", *std_go_args(output: bin"kubecolor", ldflags:)
  end

  test do
    assert_match "v#{version}", shell_output("#{bin}kubecolor --kubecolor-version 2>&1")
    # kubecolor should consume the '--plain' flag
    assert_match "get pods -o yaml", shell_output("KUBECTL_COMMAND=echo #{bin}kubecolor get pods --plain -o yaml")
  end
end