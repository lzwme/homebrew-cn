class Keploy < Formula
  desc "Testing Toolkit creates test-cases and data mocks from API calls, DB queries"
  homepage "https://keploy.io"
  url "https://ghfast.top/https://github.com/keploy/keploy/archive/refs/tags/v2.11.7.tar.gz"
  sha256 "9e442d4a868544fdf0cddb07f0e384b861408625c3a51f26e67f6b8ce5507748"
  license "Apache-2.0"
  head "https://github.com/keploy/keploy.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_tahoe:   "3771ca5fa60dc22236bc616ccf86fb8968b481190e5a06b521ed3fbc978f4dd1"
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "3771ca5fa60dc22236bc616ccf86fb8968b481190e5a06b521ed3fbc978f4dd1"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "3771ca5fa60dc22236bc616ccf86fb8968b481190e5a06b521ed3fbc978f4dd1"
    sha256 cellar: :any_skip_relocation, sonoma:        "c5657bab3a9e8efe21d932d98b691b6a048edce7e2a3b0a87d2cd212c99d0fac"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "88a1c0e4a447ee6b7afb7f26c8861445250a29d7dea6ed212022c96999c0f13d"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "79eaa1b85dc54a291c1475d58de1054f5ea4f1946690ed604f86fb9e434517f4"
  end

  depends_on "go" => :build

  def install
    system "go", "build", *std_go_args(ldflags: "-s -w -X main.version=#{version}")
  end

  test do
    system bin/"keploy", "config", "--generate", "--path", testpath
    assert_match "# Generated by Keploy", (testpath/"keploy.yml").read

    output = shell_output("#{bin}/keploy templatize --path #{testpath}")
    assert_match "No test sets found to templatize", output

    assert_match version.to_s, shell_output("#{bin}/keploy --version")
  end
end