class Kotlin < Formula
  desc "Statically typed programming language for the JVM"
  homepage "https:kotlinlang.org"
  url "https:github.comJetBrainskotlinreleasesdownloadv2.0.21kotlin-compiler-2.0.21.zip"
  sha256 "0352c0a45bd22f80f6b26e485cd04da8047baa5de54865281fb9f89a4a7bcf2a"
  license "Apache-2.0"

  # Upstream maintains multiple majorminor versions and the "latest" release
  # may be for a lower version, so we have to check multiple releases to
  # identify the highest version.
  livecheck do
    url :stable
    strategy :github_releases
  end

  bottle do
    sha256 cellar: :any_skip_relocation, all: "cd6319f5adc895b56e02259f1e58d0497b8f1985f481a8c143050f2155a5da34"
  end

  depends_on "openjdk"

  def install
    libexec.install "bin", "build.txt", "lib"
    rm Dir[libexec"bin*.bat"]
    bin.install Dir[libexec"bin*"]
    bin.env_script_all_files libexec"bin", Language::Java.overridable_java_home_env
    prefix.install "license"
  end

  test do
    (testpath"test.kt").write <<~EOS
      fun main(args: Array<String>) {
        println("Hello World!")
      }
    EOS
    system bin"kotlinc", "test.kt", "-include-runtime", "-d", "test.jar"
    system bin"kotlinc-jvm", "test.kt", "-include-runtime", "-d", "test.jar"
  end
end