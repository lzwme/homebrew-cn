class Shodan < Formula
  include Language::Python::Virtualenv

  desc "Python library and command-line utility for Shodan"
  homepage "https:cli.shodan.io"
  url "https:files.pythonhosted.orgpackagesc506c6dcc975a1e7d89bc764fd271da8138b318e18080b48e7f1acd2ab63df28shodan-1.31.0.tar.gz"
  sha256 "c73275386ea02390e196c35c660706a28dd4d537c5a21eb387ab6236fac251f6"
  license "MIT"
  head "https:github.comachilleanshodan-python.git", branch: "master"

  bottle do
    rebuild 1
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "aa89d062aca4483c2d46d1c1c7acf61527686c517bdbf1f4378937600efe796e"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "bc10708faae2b7b260c456a2fe45f5974058e9c4ad0c83b73911d6544bdfc5d2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "1e06570611c096f0136cf413b78f4db80cf6319376a842db648c4d90ecd34e58"
    sha256 cellar: :any_skip_relocation, sonoma:         "6ddc1ce6d620c6e2a6a2e279892ee6fb39db6df7743e98d142b7e194c2028a65"
    sha256 cellar: :any_skip_relocation, ventura:        "bd61b12917a0bd0a98b3f0a1ee40a4fcb1820a19f9ef644789a7396b74eb12b1"
    sha256 cellar: :any_skip_relocation, monterey:       "02e922ddd3c05cbb1d9ecb134dbc3286287270994a49c6d60529f77b20e03370"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "2bca3963ec7606ea2f2b86f242d7d97ce74a254ad0a9d77c605746f4031d1194"
  end

  depends_on "python-certifi"
  depends_on "python-click"
  depends_on "python@3.12"
  depends_on "six"

  resource "charset-normalizer" do
    url "https:files.pythonhosted.orgpackages6309c1bc53dab74b1816a00d8d030de5bf98f724c52c1635e07681d312f20be8charset-normalizer-3.3.2.tar.gz"
    sha256 "f30c3cb33b24454a82faecaf01b19c18562b1e89558fb6c56de4d9118a032fd5"
  end

  resource "click-plugins" do
    url "https:files.pythonhosted.orgpackages5f1d45434f64ed749540af821fd7e42b8e4d23ac04b1eda7c26613288d6cd8a8click-plugins-1.1.1.tar.gz"
    sha256 "46ab999744a9d831159c3411bb0c79346d94a444df9a3a3742e9ed63645f264b"
  end

  resource "colorama" do
    url "https:files.pythonhosted.orgpackagesd8536f443c9a4a8358a93a6792e2acffb9d9d5cb0a5cfd8802644b7b1c9a02e4colorama-0.4.6.tar.gz"
    sha256 "08695f5cb7ed6e0531a20572697297273c47b8cae5a63ffc6d6ed5c201be6e44"
  end

  resource "filelock" do
    url "https:files.pythonhosted.orgpackages707041905c80dcfe71b22fb06827b8eae65781783d4a14194bce79d16a013263filelock-3.13.1.tar.gz"
    sha256 "521f5f56c50f8426f5e03ad3b281b490a87ef15bc6c526f168290f0c7148d44e"
  end

  resource "idna" do
    url "https:files.pythonhosted.orgpackagesbf3fea4b9117521a1e9c50344b909be7886dd00a519552724809bb1f486986c2idna-3.6.tar.gz"
    sha256 "9ecdbbd083b06798ae1e86adcbfe8ab1479cf864e4ee30fe4e46a003d12491ca"
  end

  resource "requests" do
    url "https:files.pythonhosted.orgpackages9dbe10918a2eac4ae9f02f6cfe6414b7a155ccd8f7f9d4380d62fd5b955065c3requests-2.31.0.tar.gz"
    sha256 "942c5a758f98d790eaed1a29cb6eefc7ffb0d1cf7af05c3d2791656dbd6ad1e1"
  end

  resource "requests-file" do
    url "https:files.pythonhosted.orgpackages505cd32aeed5c91e7970ee6ab8316c08d911c1d6044929408f6bbbcc763f8019requests-file-1.5.1.tar.gz"
    sha256 "07d74208d3389d01c38ab89ef403af0cfec63957d53a0081d8eca738d0247d8e"
  end

  resource "tldextract" do
    url "https:files.pythonhosted.orgpackages02214f2d7d6023650770112dd8144dbc47afabbfaf568a0d39abc0a4f37e8e9etldextract-5.1.1.tar.gz"
    sha256 "9b6dbf803cb5636397f0203d48541c0da8ba53babaf0e8a6feda2d88746813d4"
  end

  resource "urllib3" do
    url "https:files.pythonhosted.orgpackages36dda6b232f449e1bc71802a5b7950dc3675d32c6dbc2a1bd6d71f065551adb6urllib3-2.1.0.tar.gz"
    sha256 "df7aa8afb0148fa78488e7899b2c59b5f4ffcfa82e6c54ccb9dd37c1d7b52d54"
  end

  resource "xlsxwriter" do
    url "https:files.pythonhosted.orgpackages2ba3dd02e3559b2c785d2357c3752cc191d750a280ff3cb02fa7c2a8f87523c3XlsxWriter-3.1.9.tar.gz"
    sha256 "de810bf328c6a4550f4ffd6b0b34972aeb7ffcf40f3d285a0413734f9b63a929"
  end

  # Drop setuptools dep
  # https:github.comachilleanshodan-pythonpull209
  patch do
    url "https:github.comachilleanshodan-pythoncommita99fbf53139bad62fe5ba8f41ac130d5212cbf71.patch?full_index=1"
    sha256 "3f674707548497ea79c760697e4cd44afe0e0df4433b3b49af8ea3637903acd7"
  end

  def install
    ENV["PIP_USE_PEP517"] = "1"
    virtualenv_install_with_resources
  end

  test do
    assert_match version.to_s, shell_output("#{bin}shodan version")

    output = shell_output("#{bin}shodan init 2>&1", 2)
    assert_match "Error: Missing argument '<api key>'.", output
  end
end