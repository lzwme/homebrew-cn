class PipTools < Formula
  include Language::Python::Virtualenv

  desc "Locking and sync for Pip requirements files"
  homepage "https://pip-tools.readthedocs.io"
  url "https://files.pythonhosted.org/packages/fd/01/f0055058a86a888f32ac794fa68d5a25c2d2f7a3e8181474b711faaa2145/pip-tools-7.3.0.tar.gz"
  sha256 "8e9c99127fe024c025b46a0b2d15c7bd47f18f33226cf7330d35493663fc1d1d"
  license "BSD-3-Clause"

  bottle do
    rebuild 4
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "ed82cad8ebbbf4bfb447d49ea3e89e5546be4c8d1254b7c04283fd2b466de036"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "3dcff6c22ef1a05f5846bbf9cf431b344050e2b3e853800a996dab97ef9ee1c9"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "329c56c262ca94575608eafc4942da4e0f2da6d620f712470b34333fdd96c033"
    sha256 cellar: :any_skip_relocation, sonoma:         "921d69128f0eb2a9a6ff78c9b5008b6cb0209253ef1c4a92f14171c1b4f180f5"
    sha256 cellar: :any_skip_relocation, ventura:        "3cb23886622d45b3baec561b870ac8b867982e4f936ae9d702f6097fc53ea0b6"
    sha256 cellar: :any_skip_relocation, monterey:       "de5f7ece56856ef180a01f074ad836dbf1704a608e95df5f3e727d46c5acf683"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9cd55fdd04736b8d83a06308a650b921e4bce51096d713d815ef2e1ae398fdda"
  end

  depends_on "python-build"
  depends_on "python-click"
  depends_on "python-packaging"
  depends_on "python-pyproject-hooks"
  depends_on "python@3.11"

  resource "wheel" do
    url "https://files.pythonhosted.org/packages/c9/3d/02a14af2b413d7abf856083f327744d286f4468365cddace393a43d9d540/wheel-0.41.1.tar.gz"
    sha256 "12b911f083e876e10c595779709f8a88a59f45aacc646492a67fe9ef796c1b47"
  end

  def install
    virtualenv_install_with_resources

    %w[pip-compile pip-sync].each do |script|
      generate_completions_from_executable(bin/script, shells: [:fish, :zsh], shell_parameter_format: :click)
    end
  end

  test do
    (testpath/"requirements.in").write <<~EOS
      pip-tools
      typing-extensions
    EOS

    compiled = shell_output("#{bin}/pip-compile requirements.in -q -o -")
    assert_match "This file is autogenerated by pip-compile", compiled
    assert_match "# via pip-tools", compiled
  end
end