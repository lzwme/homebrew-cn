class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-07-04",
      revision: "ef9b4e59628561358325fae93ee3d3b9959a2693"
  version "2023-07-04"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "89912fffeed61905099bf1bef7b045a6b99d92c490c12ae4f59cab79bc4b204a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "e4d9393f3c4538f42077f1469fe666c70624eeaed54df0689c3f0550069b5fc6"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "8887435843f709e2cfdd548ef5dcad99103a8dbe702eea2c56f77c2e32cb8435"
    sha256 cellar: :any_skip_relocation, ventura:        "67306432aa72a7d9caf51d2401e055530ae03d91ef4dbc0c79015289b3c9f4a1"
    sha256 cellar: :any_skip_relocation, monterey:       "e6e8c08e322e3657b2ec18c9d0ce2523dc73c09b2d594ffac27f175d0d6b7e75"
    sha256 cellar: :any_skip_relocation, big_sur:        "97e9ef974726dcab43d080c10407dbfcbe2fda60f314923ff473c6c2375a4afd"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b921e8650cc82f0584afa7f4d1cc32e69c6109ac842e093e6cc45491a5dc205e"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end