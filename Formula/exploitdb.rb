class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-15",
      revision: "2f07358143ce98db0f5988a0a9a3379c20c13ab2"
  version "2023-04-15"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "ca5a0190fb8be403c7cf4c1d6ebf191f750677e74331735eb1ad07fa5bd071e3"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "3f48b2d07aa589ea43dcd7e4d12b5b54108ea6394c81428fb2b71dba76110d39"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "c6b5cdefac68b89e31545eb5cdda6bdadf9a15b85be31468ab61e4350d586829"
    sha256 cellar: :any_skip_relocation, ventura:        "1434e59a56e90a300489d90e2910b0ac2b3ea49e4e0fa8d54e9815b7bd2fe8ab"
    sha256 cellar: :any_skip_relocation, monterey:       "c033fff8906341451f8a27cbd9dfd5b483dfdb04542618e392d4b0294aa416b5"
    sha256 cellar: :any_skip_relocation, big_sur:        "6c57b302981abe5200c60da898f1e46bacd0ba10b18672a7d789e61f704da283"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "030c7cddab221bd76fe0ae56061f4b719263a7895bb688358bc472bb0981370f"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end