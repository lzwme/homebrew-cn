class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-02",
      revision: "3de26153c8b6b31944a35d18eae2b4a20b42bb1d"
  version "2023-04-02"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "1d8ee996605bafbe3c68fea64e57d8c15c914acfc9890f84893e7a1ed78d16e5"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "808bc398d79ee52858637559b03bda07b0feae2f71ee9af143a18f4e8b20286a"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "e8e13c61f6b056a51305447de9ec78092d405f689a5f102236ee2002cc001c92"
    sha256 cellar: :any_skip_relocation, ventura:        "2f3301fb82e37e8d51fe274d7eda1d860627a5484f7016b352bc622d9369eb8e"
    sha256 cellar: :any_skip_relocation, monterey:       "6f8e010f76655dc201f84a9def838e3b098de96c0f6ad91790f1bccf42054725"
    sha256 cellar: :any_skip_relocation, big_sur:        "05de4c3cabee554a4768c6b603fafef284074db0796c0ffaa0522de01ee48cdb"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "e173b9469da3387b574dbe9310684bc754471874ec28c5b57cb9414e3aeeaca2"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end