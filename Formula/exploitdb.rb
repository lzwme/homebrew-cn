class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-24",
      revision: "c79c4813de065b07f2729a2655a84ac0d8cdd803"
  version "2023-06-24"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "7d4137e80c2e25b7fcea4b6674d2b1094cf63d93f76cb95140a725fd95f247a4"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "a863e790cecda159c2a4407fe84c0f4a831ee578eff087df3b452fa5af91b732"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "1dfde532fab5fd2e3868e65ae2f1d5eefd2bbdbc0d8b50524de223e011ef3c87"
    sha256 cellar: :any_skip_relocation, ventura:        "0c8aa8f13b7102b22637678158ebb686f043a09b0bef770492340408c872a838"
    sha256 cellar: :any_skip_relocation, monterey:       "370992f6b58b1fe0a48ed0ad26f78ddd9da1e618e0bf6f5bd1bc11bd15f034c6"
    sha256 cellar: :any_skip_relocation, big_sur:        "b730ad627175cbf3efc6a1f1f24fd55f149285e2ed460fce6c945d3f1b847838"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "485a239b9035e0313b302a8664f393f768143ad7434a6354d822d737c48dbbdc"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end