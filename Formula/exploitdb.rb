class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-08-01",
      revision: "5eb89a2046eb3008494287259d823ef3f54f74f4"
  version "2023-08-01"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "65fd6810346767b0a6211a96c2ebf4d987265967e60eaf71c0f01c001fb5aa5d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "b937b150836cddd55887024293449e673d1c6a0f824869ed5ebffdb0d796c421"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "c3427bccd984b9b56213e617d6e3624a43b2defcc81cc49ad7fe91dfe6323a07"
    sha256 cellar: :any_skip_relocation, ventura:        "39a49e70aa88e09eb9a90109a58f04ba7942e97906e8f6934cb44bb87e49be3a"
    sha256 cellar: :any_skip_relocation, monterey:       "1926e7002547dab47ddc072304c881ea99feb4f4cbc460251b2deebbdefaaa13"
    sha256 cellar: :any_skip_relocation, big_sur:        "61a5734e55b74b7f193746a441ae39777daa24d454ebc374ea6280db28e5243e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "fa7bf68a4c277a4c72b8d40b73e4bc7d1195260b0ef2ed393cebdfb90f01c7af"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end