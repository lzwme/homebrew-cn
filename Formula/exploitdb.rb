class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-13",
      revision: "551d56f6ca3fbeaa21c8fcfbea1aa45e00a6bf18"
  version "2023-04-13"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "c15b8748d42c1acdafe8530d7d0dfa50a549c57f3d90f5920bb1948959eec591"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "8f07e367d07056ef8d2260f881fd3f718543c0d2140a06d25ad422022640b68b"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "4e1aaa65738959d5ec9bbcdc8083ed2e48743df7d38318fbc092d7c460e591a3"
    sha256 cellar: :any_skip_relocation, ventura:        "3bd08ff4597a9fc95d84b52cc827008a4225c65ad658d41361d463dcf372dbf2"
    sha256 cellar: :any_skip_relocation, monterey:       "6763047350fadb408c5837b1fbb0a31bce831cb6659a73bc132348e642d6c766"
    sha256 cellar: :any_skip_relocation, big_sur:        "6ab1c93b296934255bd3a38bd49808b29e96a626c8e98d9f2298ab2771f7cca1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "fb252b37de234936f87179bf4c3070e018fe1fa35ef88385828e38af5414c58b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end