class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-07-21",
      revision: "98cdb051068f442c05d9c11f507a02a5bb7c3b61"
  version "2023-07-21"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "eb4c5ef1582e4752b0848703b3e8233d5b9973fd68aeac9fcc90d8726141fde7"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "24686cefde2cf864b987aa778ab80e06c260abba5813af71dcec85a7594cfd72"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "17c47636421df6c378f472486347f677ec26dd24c08d433c6fade6110c21b343"
    sha256 cellar: :any_skip_relocation, ventura:        "e46ef4d925834b1cc9d0d4d0d4c0b0baccb94cca819fe81ccb72da356ad3a649"
    sha256 cellar: :any_skip_relocation, monterey:       "75eb1e62f70739e4bde054ea3e79a9bc440ef4b62845ba026fc5e4faf32eb5f2"
    sha256 cellar: :any_skip_relocation, big_sur:        "25666786b5e76f4c758823e5aa7e6dc2ea97d1d7dcefe1e1aeb2180837d0a14b"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9601cc781d38036d5f56d23b42145a8d954d6132d125da4ff7724667b9970a55"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end