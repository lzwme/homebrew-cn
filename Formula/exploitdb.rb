class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-07-20",
      revision: "3a3c03321c3d2b4016ecd11909f91445bf401cc6"
  version "2023-07-20"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "56d871c29bdfc2b757bde7cfb628e2f7d5dfbcae5ded8da00d249a67e8fcb61c"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "31d97138d31faa1ce65f11003bd79dda9e929e3b78cca8cb365443d6232f75a6"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "b4e35615ff6bc767fe9bce90be677aa2a83b4bb21abf3c6a17cc74affa24c417"
    sha256 cellar: :any_skip_relocation, ventura:        "ffa8a403a89ed1d38bd5d28fe36ebe17dcb47209c0046cf899a019fb7543c8ca"
    sha256 cellar: :any_skip_relocation, monterey:       "bb14f9d82233e896e930769755ce42c83db2e1f86ae56eff7f04f1a7d9cc74ff"
    sha256 cellar: :any_skip_relocation, big_sur:        "3f1919e086e1d6a7cb9422c9bbb4049af128803b5e76c66af7124ea12c429aa1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "434fd1379ad22d4fa4fc6333b7f01d7538fe018648d22322615817c9af8013a2"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end