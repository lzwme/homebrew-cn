class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-05-24",
      revision: "0a7adaa3fcdd8a907b3f89e0fdfc59ab67f6ffab"
  version "2023-05-24"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "4835a6784c0ec7e523f8b7c7720dc13a86f3e983ead0485465d35333fb7ff030"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6c241dc01e0d80e1c5c385d2f373cc8a4fdb65aa14a1a0c05474dfda82ef0a68"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "a66495331ec0480940bb67b7816ab7fa4e7edf102309c751d74cc5c5e17fb9e6"
    sha256 cellar: :any_skip_relocation, ventura:        "7983840353b8689f4c344d5c3d50032c2a18bf515ed3c20c709b18a726a6aea8"
    sha256 cellar: :any_skip_relocation, monterey:       "cefc5adb29bb583f8b007e8e1b93ee1816edad1ba0018c22755a154aaf3aa512"
    sha256 cellar: :any_skip_relocation, big_sur:        "6b4326353b3ec6831039d356988e4e0ecfa57a225d02a50fe32879470e612265"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b94bdd48ca3a83d88979d0bfe70dac2d57001bac4490594dc8773ad44da0428d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end