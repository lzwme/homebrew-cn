class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-07-18",
      revision: "20fe50e6db351200cc6eac3777b2c762c7b4d303"
  version "2023-07-18"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2b77ae7ca540fef387dc5db77573993d86871cd00ce8602503dad3ca8922b0f9"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "016686f258520a23df1d21e3c0687e2b648680a62d4bb5eac779b6901066afbd"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "c2e5e3f1cdca0b80ad9cf72ef5f48fa9d0a969a8da2b2c0ad0a04cde90481142"
    sha256 cellar: :any_skip_relocation, ventura:        "02b0be3830480703037d9dbac8d9571f8f7ed91c77733d975f71d9679d3c7701"
    sha256 cellar: :any_skip_relocation, monterey:       "f27956bae3721b6853926217a25afffc2ae470eed6a64c2ed9e3169b2753a31f"
    sha256 cellar: :any_skip_relocation, big_sur:        "5fcf90bfbade8b55056a3aea07c72a9006b5b727be851ad202b12d091f6b3e1a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "1d132aaf73e928e7ab445b0026748922fda5dcacfc666d2e8e07bd5c6d31f3f4"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end