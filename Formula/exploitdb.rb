class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-03-23",
      revision: "6206f4f20893f64c4556027331dc7ccf18d96c4f"
  version "2023-03-23"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "9ffa6408350f77d265f8a5acea67262c431b5a6706e0f3adb1f98c885937def2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "b77ab15262edbb54943529a7b65e7e28bd60152b6c056d4d6c372435c6ced536"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "cfb0214d86a185dc200330802abfe59a7aeb44484c71fc0277ccd195a4fc1a16"
    sha256 cellar: :any_skip_relocation, ventura:        "11f0605d80778356bc51e14913e132ffc3ea358b4f3867f94dbd53d8e823e4eb"
    sha256 cellar: :any_skip_relocation, monterey:       "66078f771c5126af8781685e46aea9cf516a16584e74c255202ae344c1ee3605"
    sha256 cellar: :any_skip_relocation, big_sur:        "1fb7b601a0e56e94af445e6804a99d5efa92b160af57ebcf2e57f21d74c25eff"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "5265949f3b6fd78634ff1224c9519d7bce71e94c8d607d555e7c2072f2e4c002"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end