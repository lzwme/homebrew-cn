class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-26",
      revision: "7e3a257da82301e993b361fdf6b2681b962cfc4b"
  version "2023-04-26"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "fae89c527517bc3c4305a55277d621682a62273f3f8bcefe5dc1933a036f026a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "5f53df89a760f1533bbee9ccc5b57930e24b9b685507ba451cb6f170ba215bee"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f06720000ef75b3bcb8254e0aed396d54b1eabd5db1defa44ddedd630b23ed3b"
    sha256 cellar: :any_skip_relocation, ventura:        "04a4b68e2c0db8997e67cf27f633a1dec0e797f4319c96e9210af86e99598a29"
    sha256 cellar: :any_skip_relocation, monterey:       "541714710fed8f7daf82d2467f4afb3a26f2e4db9a1bc6c81866ff82be881352"
    sha256 cellar: :any_skip_relocation, big_sur:        "7b2ccc928ac69fe90c357c4ac353c62fdcfcdfd3963ce12e19458d5161c36e31"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "00a69d22c41ceb2554d1498009f16f9a596303545d283f247c3b0255625382f6"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end