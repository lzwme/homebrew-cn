class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-25",
      revision: "673c08ece5b5e0eeaee5fe3c83f0f1df51f578ef"
  version "2023-04-25"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "4753699e93792385141edb49ac67cd7a21c57dd1dcf60913e6e0dfb6e3a06e0a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "608c99c8712a857f86c24f9f38e42a41fa8b4094955faf93d62e5fc84c9d24f3"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "70bee7bd565b305aed663c888833e10c48de1e2d67d6f58ca04477b123970f04"
    sha256 cellar: :any_skip_relocation, ventura:        "94da06887cf75eb87ba0b46fb9b9b02f44d8280f6fa8b00f33fe2e849a185a64"
    sha256 cellar: :any_skip_relocation, monterey:       "a5082fe04e85d960642a33b8fbb432a7f51585869c697677d6976ff81a1ae501"
    sha256 cellar: :any_skip_relocation, big_sur:        "00f1d47865d3c5cdd91a7f27f7c7061fb1ca3ed964e29f4a0fdbfa7649689590"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "7a08c173ed77ff16c78c46664554a6886377385a0594cbc91f400c3b517b9e2c"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end