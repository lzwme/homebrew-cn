class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-03-31",
      revision: "42ade901fecb2437c39bfd9bd155765aa7b32a37"
  version "2023-03-31"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "9ac9f0bf751c66e62e2451424922985bbb35aa648ec92b0a6c1f027f782ab7be"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "d8645eb13ed01ae427d08230b7232c0e8fa8a369b508a744a09ec14158e651c3"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "91e306bd7ea24930e8ebfc85242548de5a89d728dbdad4d7c4818bc3481404a5"
    sha256 cellar: :any_skip_relocation, ventura:        "88aeea493f37695c59a740fa9fb01d64a21f69df68471fe7f9eed3fffa7f3f8a"
    sha256 cellar: :any_skip_relocation, monterey:       "d0ff792233e79f1cb9d6198826b5ae1dcab56b6a064f8cde04988b3ef2c0ddef"
    sha256 cellar: :any_skip_relocation, big_sur:        "b88df4746e43d732663ee5d8334c3a52d4157efe055595a4be52f2125d79fe2a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "70c3d1a07a5d8c19faf68802ffdca701b6cb1a1bb949f6d3c431c70129f66393"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end