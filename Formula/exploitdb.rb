class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-09",
      revision: "85954a8fad0cb969fa9512f3b267481c711573fd"
  version "2023-04-09"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2e7be131a1fcdf5f6ae740c07ead8a32b35a4c30e65cfd287de89dd0868838cd"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "8a62cb4a35da60d67a0f9c32bb2c509c4a0cb4d41ac4673711009f12fe3cfb09"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "c2749fbc19b8f70c2685fe77e1aac8e3c1850f8996062c9d2bbd0aff7bbd952b"
    sha256 cellar: :any_skip_relocation, ventura:        "75b77a08a08ad9496abd2f5236b9b26aa44c42b497d539e5499fcaa3b358f55b"
    sha256 cellar: :any_skip_relocation, monterey:       "548e644ede2ae9bee6ce39d933003174d9a328fa57888b93be921a1e9a5727ce"
    sha256 cellar: :any_skip_relocation, big_sur:        "6255cf67ff6322b4ddf5c34e67ff9f6f8f5b3e37285b1ef080d4cf25c6a4b0a2"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "d42aa3fa25b1333efa7481915bf9dfe927c16353147463f9b6bb5091db735455"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end