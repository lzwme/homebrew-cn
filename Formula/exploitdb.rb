class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-04",
      revision: "d4e68dbb7e0c2d72ce07e2b596df013e81df1a64"
  version "2023-04-04"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "0b8f1cff9ebe24d185b8b1c19e5681284120c6dacc6ad45219d2349213dbbc93"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6bc342b81764c1b776448ed03b4b1f80bfe0dcfa13e694972cfe940d7ea432ed"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f4db0b8218b9d180048ad01fea1c6e69b2d12390458bdfbe55602d47fe0a6d97"
    sha256 cellar: :any_skip_relocation, ventura:        "a90d6b783b61a8382517f534f3697f605f0dbb17c4f81b8647b23d5b541a8ab6"
    sha256 cellar: :any_skip_relocation, monterey:       "68afcb6451df007645c51ce78e64a2c9d96b5273c0e8bc8ada1f2473ffddfe04"
    sha256 cellar: :any_skip_relocation, big_sur:        "c61b1c9a03e83fac0a5c5c82744231b4ec152855df95b994fd6c525e7f53e833"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "6c0d97784bbb0016ff67afc8efe5752d2985ebfe4d5c00bfdca7d4e7181eb846"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end