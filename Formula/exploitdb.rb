class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-03",
      revision: "5f38b443479a9d8af79f0937846e30d777719c1e"
  version "2023-06-03"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "6c617c2971d5e68c4ccba7287265c4f6ecc297b45ef49046787aa20af4d9b8d0"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "ec2998403af04d487cd8613315727b75bdacf83c4a10a6a39fcc3700c04a67b0"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "22850db8c5beab9da4ef76e658c15c13d9b068806caa88ddf54d195f4a902934"
    sha256 cellar: :any_skip_relocation, ventura:        "b5dc75d1114b7446f0012e0b2e87ba9fe1f62ece8bf4b406f462378c15dc7ee6"
    sha256 cellar: :any_skip_relocation, monterey:       "3c78f137b3f848fed3da89acbf81f89f4a0f716fc684ed3271b16b0b97632315"
    sha256 cellar: :any_skip_relocation, big_sur:        "7cd5725858ac48f897a825d28e3ea62acc21ae10fa30ca2813476b14b8128edd"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "d3fddf09cd1adaff2d8c7362fff08d7f094374c5b659dde00df2b9dfbfb96595"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end