class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-07-16",
      revision: "fd788a92e392137b89b99805da8d6cdda5722e03"
  version "2023-07-16"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "5fe66f4b376d66a89f8a6c3ad47105ae88e81da71d91e1b2446c004d9686f6fd"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "0a56ca63bcdd0b35be780330c9d98725bfa9efe6943759c6fff15457e26ed993"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "bc541045ac7277381f7b8c8f31a5624495bcf376dc399b72ee2d0afe6beabef6"
    sha256 cellar: :any_skip_relocation, ventura:        "c3f6eb7adb3233cf410f0a938196125f022dd0375b4885a046bfcf5dafc50852"
    sha256 cellar: :any_skip_relocation, monterey:       "d19241f43bb55790a25db47c9fb4c4c91845494c3cb757be779df9d927b3a4ee"
    sha256 cellar: :any_skip_relocation, big_sur:        "7dede2a0415076f7217d9a1cbeafb5842aa4acd897108ae0fcb51b9fba4ede05"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9bc784fa240e89a802cc3f9b14070cdfc37e047ded0ee91834bd3cc8604e7ebb"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end