class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-05-08",
      revision: "aada2be87a483b374b183b1b55f1b6dd65d3489c"
  version "2023-05-08"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "dbae45d9741f5c5ce1cd9388d14947157945b4b02d6cfa363efcf2526fbb4d08"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "63f332f8f40f638346fc2c8db9c7086de6ba86599bb976d77b2f8d013921a8b4"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "37bbf0bad3e8bed84718f6ca1b1a4da2b124a38d9007f7713511a4e104e81674"
    sha256 cellar: :any_skip_relocation, ventura:        "987a51228e77bab9e7ad8650ac8cf9c94babb309132e50ebaa2db24220193e19"
    sha256 cellar: :any_skip_relocation, monterey:       "52b4ef591f6c8c84266e30aff7423ba7831720385bc531ef6c4f035717b56c80"
    sha256 cellar: :any_skip_relocation, big_sur:        "ba3a4c42f41cb4646ebc0798fdbb18c9c6d5e62a962e2060d99301ee0446a843"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9491b55a27945b5205e8c92d9e572f80858e234327f4b77d3cd8f6f95f76b804"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end