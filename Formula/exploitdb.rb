class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-08-03",
      revision: "9229ea6f66bb8ab3854a7c3178c7506eb3165749"
  version "2023-08-03"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "0200ff4783ece3d124f7920c3d189477fddfa3b07a3747aad30465303142ba1b"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "dd0d8675b968c3f014e6a2dc68df1a7d5e1886d62aa110f1206a08d7611507cc"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "0d18282ee57fe6a6b9e95d7bcfc067cc68d703f39d2e6b3802d96c835fd6e727"
    sha256 cellar: :any_skip_relocation, ventura:        "c0e72324e4518bf28f9522c5a899098a2417852e26d7a68cb0bc94dcc1c4757e"
    sha256 cellar: :any_skip_relocation, monterey:       "f114fd36848e9c0c01f57a3e90cca77c25129bf58e0a587cba7e18d0e6a5abe0"
    sha256 cellar: :any_skip_relocation, big_sur:        "3d72e2563d04a43fd2c46f9a56f20c05b1514f7ef9d8f3ca3567fa4d3f2878e0"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "18f8d31aea7b062faa2aea5b0c9bcf397506233920cad75ce945bec79cbbf266"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end