class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-14",
      revision: "ea8922f91d1ce1c29fd047bf026a90b149556d25"
  version "2023-06-14"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "0748297a2e6f60209ad12a95434ccfe3ec46c3eeb64068147dc919aae505ea0c"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "32294e3cf7651ab0d9d4f7dbfef6fe59084a337d1041eacb223f3d55cd8c9499"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "ef38be7408584753f94df42e00dfc3353288b4059417fb2fa8432682243171d5"
    sha256 cellar: :any_skip_relocation, ventura:        "b7b928cd3fa4804f8d1c29a93b4e42c8f6927fdc37b38c27b1f498b2820230aa"
    sha256 cellar: :any_skip_relocation, monterey:       "2e280aa4a17e7cdef475f749cda40a5e93fe0a1c446e44e5dc8c6f9fb2ebb521"
    sha256 cellar: :any_skip_relocation, big_sur:        "aa0ac69330dc82df8a5f86411edd8f705883948b013915d48e7b69bb0032ea90"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "41d230ab868eabd23dbcd59b70d0b7026f2c0d7fa9b8176154e3c40bf5313268"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end