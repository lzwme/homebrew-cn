class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-03-29",
      revision: "6bc7a6f9b034750559770a790bb0c0055b002ea0"
  version "2023-03-29"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "40ea9b7ace57e7c3a273f80de5786d4e3d6c45057aa5c3ce615f96487023eb5e"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "f3edc793ea174640bd04499785f416e148a69a8605f5913f65bc4943381db640"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "85c124f4deeb514d49e6fb9a9a70a74a9e86fc866fe5ed16a4327c77149858d6"
    sha256 cellar: :any_skip_relocation, ventura:        "9af47d502ffe63477a2b7a2956c3f14f1f607e5171c70855acecfa3450e6a54b"
    sha256 cellar: :any_skip_relocation, monterey:       "061da8a5368ee3e76169221a979fa7de8c9505d880088929d530d2791dc4d881"
    sha256 cellar: :any_skip_relocation, big_sur:        "69045aa652d63816b176f8434fa8b5be247af2210b7e6e1ccab9c602cd480b87"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "e70f60111188e519584b809bcdbe61904b9b54eabf0b2e98e71fef260b96e5f2"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end