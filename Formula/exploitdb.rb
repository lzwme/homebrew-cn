class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-05-19",
      revision: "7217cf5c90106d6e504fba6f6dc8f33ef43b585b"
  version "2023-05-19"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "88f9e3182e12d827245e5429e22a2cb6893db908411ca02fc305085a510c24e8"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "31da7c93fe8c0fb1cf210c2989286ec31a7d0f44f11aa6db8162c19bb3fd9cd2"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "9f09329076959a698e00b265a0d9159d1279744305e20494dc03eafe556944d7"
    sha256 cellar: :any_skip_relocation, ventura:        "585d17ca1ba633d6bb6bffa17d27c76789d91fada5be1c506d2415d4547049c7"
    sha256 cellar: :any_skip_relocation, monterey:       "f334c3487b97b150ffcfa8e64a69a274c40ed1bf68929629c59dd34b3d61934e"
    sha256 cellar: :any_skip_relocation, big_sur:        "866c5a7dc507e28063c8f2dbeea54d1d0057c1e30ce3b422add882c382d06ed6"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "7a8f34c01911a69b21abc5078f6f182e2ca6dca8f514eea14b2507282449df01"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end