class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-05-27",
      revision: "9e36596021d19dadc97fcc4441fbfda0096284cb"
  version "2023-05-27"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "13f005d76a8b737598ad94b993ec1a075dc9f321ecede0e5d104b0a937851ee2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "0899e99653741f177628afc34926530f74e1adfd71ecec66736d97e390196f89"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "187f387440aca00e48d7d8443972e961967749da8681fff014b70a9eb313578e"
    sha256 cellar: :any_skip_relocation, ventura:        "d65b07a46021a6c6b39eb73b3b3f332c325ae936d3cdd9e8b7db9e77c24275f9"
    sha256 cellar: :any_skip_relocation, monterey:       "f0d83373332745676b0c469844e1dac9b5f5eb398185db828102c0920844865f"
    sha256 cellar: :any_skip_relocation, big_sur:        "2a49863526ac1cf2c52ca766503c7825f78ef5f99d6912785dd43630b5a78000"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b4d8b2a85298b32302a073489a7a45b2a8145a114f2553fdb4e939ebc18f2583"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end