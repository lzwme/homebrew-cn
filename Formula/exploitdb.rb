class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-08-09",
      revision: "69f3ee7722635417f30d40dab5b75bdb983d36be"
  version "2023-08-09"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "5cc2a4074a470368c004165de8b363eab99ee0e98a876e32cc0e20984c480ce2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "608baf2f6f48657fe2f292f4b02c9c63c939425bf82ebaa5f3d8c83f14a6e290"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "ffc3d35d335e841dae0f1234204d17e0aa6ec8b0b0fac13feac1f2cb2bf12d7c"
    sha256 cellar: :any_skip_relocation, ventura:        "4127bcdfab52b0e05d2dd57f7f3dd4eb2dc4b87c34d9b5432ca733ef2ce0cfd7"
    sha256 cellar: :any_skip_relocation, monterey:       "aba17c3f37dfa3b626753c0866c52b00a97a29bdb2bafa6d08738f012eb70dd7"
    sha256 cellar: :any_skip_relocation, big_sur:        "6a87d5ad84a16e564dd6f742553937ec49efeca43cde84b76534ca933c1c20f7"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "96ddc9c8288862f4933a7608f86363445f914933e1975078b1f0fd25ebb29494"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end