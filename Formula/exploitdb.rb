class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-22",
      revision: "00f6b3e7eddbae01a91589d5defa438a1475efe1"
  version "2023-06-22"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2e921b8b8c2caa0494adbc11435a4ce12e07562a79acad81aae917d019238d6d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "c901ecd0372d4f878ba5e5d3a3eee6aab7500f6e10cd2c29c2db06116da64cbc"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "43b654aee6f2938b07d5dcb4fb7222998bd71ee738f9af9504fd58624907c721"
    sha256 cellar: :any_skip_relocation, ventura:        "6b90ec153e5baaf51f7b2f1f5acdf4f6fac1d78eab9c74659746a7689c95b642"
    sha256 cellar: :any_skip_relocation, monterey:       "4cfeeca9a1bcb95413e46d24fdb1ea5e85740f6f96da007981559d77ea686e15"
    sha256 cellar: :any_skip_relocation, big_sur:        "f7ac67624df3d7ef64e083512eaaa232dcb5744ed3ea0b51df7986768a3164e3"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "2d6abf7d476745e8bdae4dff3c479a6848289a40b15cf9e95b6db07b6fa981de"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end