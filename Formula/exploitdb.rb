class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-21",
      revision: "cc495bca113814a2089c64bda5540c0dddf7dc20"
  version "2023-06-21"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "157cb2ba0a32271960a6124cd2e31445b5cd160baef396d32bb8d808af1a0e68"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "e481b566547f53d83f5587d523a6a51de1a8c3c9ca6eeffd95ed7e5284f03a1e"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f36df037d7c7ebad1b250a0c49b57a002c72cb69a60f5ee6fdf58ab9a79033e5"
    sha256 cellar: :any_skip_relocation, ventura:        "7697f65334fc30f2cc5f8944162fef366929cfb06ea7be869b1780ce1eba0e05"
    sha256 cellar: :any_skip_relocation, monterey:       "3c677e84c3d422c50826ce42bfa401c25769a43d268420485ae3cb317cb34be3"
    sha256 cellar: :any_skip_relocation, big_sur:        "e405babe2a8967f06e6f7c7272c63f128bf7b3694b0e3144100ca469c3b7003f"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "c2e9f1b9833211cbcb9132b22a1e8eda7eac59466c1eb897f32ebb43c96bac14"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end