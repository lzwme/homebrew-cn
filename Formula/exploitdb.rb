class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-04-28",
      revision: "1015b02d68d04f5f362b88946b930d584a8f9269"
  version "2023-04-28"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "c1e4854c081eb87038b1f0b47b93e38b0efbe1ac6fc25c85ab51865379f71e3a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "aea987c4569fdf39555c040afcd435baad38e51f3a53c7d815e340c021533fc7"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "9d0532369df87ef95e7ab92b08480110337cc2599c2c11327986f37c158b2601"
    sha256 cellar: :any_skip_relocation, ventura:        "eff456632da7094a3263657dbac7297c7dec30bc014e8b8ab58a9213b65379cc"
    sha256 cellar: :any_skip_relocation, monterey:       "1050431bf58f62d15c875b9ba3370613f75c15003b13de5b042526d77605ee98"
    sha256 cellar: :any_skip_relocation, big_sur:        "362a29a9594712bd2915ced2602d17f1c5db419ee84bbed986db0149a2975b8b"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "a28ca0c6f59803b5c59250004d53700874056bfc6ba16bad5221bf0a19dc482e"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end