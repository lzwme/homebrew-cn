class Typical < Formula
  desc "Data interchange with algebraic data types"
  homepage "https:github.comstepchowfuntypical"
  url "https:github.comstepchowfuntypicalarchiverefstagsv0.10.0.tar.gz"
  sha256 "27e8d7a2cde6ab942e4ab814851fb231d61e77327e008c6f4ba84be7d095f26c"
  license "MIT"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "ce7f5e30b8041ce2e5188bef7e94b0d584f837d85c2e45c5db59ea96752488ef"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "f79fad10e04ec8432d4d34c2b37e0a8d6f43568c9a040eef995dd4d2fe6b6bdc"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "fe9007a5f9ca4d41ec25ae3ced6ba388464a1110f70ebbe108734dc39694dd4a"
    sha256 cellar: :any_skip_relocation, sonoma:         "c15da7f6598fae0e3968b8841de10bbfe75dc91c9f82ec2735fc7400179092be"
    sha256 cellar: :any_skip_relocation, ventura:        "e38eabf6bd6530adea49ac9d5adbf9dfc6cb7069bd7bd687992b44fb0374d053"
    sha256 cellar: :any_skip_relocation, monterey:       "359740c9af8c53b5e16864222a1dbfc3d909589ed242eff53fca0cbce513449f"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "456efa1a526c4c8d8378ede8f9688710b9f181c00c7cdfa3b8ef08d45e12642c"
  end

  depends_on "rust" => :build

  def install
    system "cargo", "install", *std_cargo_args
  end

  test do
    (testpath"types.t").write <<~EOS
      struct SendEmailRequest {
          to: String = 0
          subject: String = 1
          body: String = 2
      }

      choice SendEmailResponse {
          success = 0
          error: String = 1
      }
    EOS

    assert_empty shell_output("#{bin}typical generate types.t --rust types.rs --typescript types.ts")

    generated_rust_code = (testpath"types.rs").read
    generated_typescript_code = (testpath"types.ts").read

    assert_match " This file was automatically generated by Typical", generated_rust_code
    assert_match "pub struct SendEmailRequestIn", generated_rust_code
    assert_match "pub struct SendEmailRequestOut", generated_rust_code
    assert_match "pub enum SendEmailResponseIn", generated_rust_code
    assert_match "pub enum SendEmailResponseOut", generated_rust_code
    assert_match " This file was automatically generated by Typical", generated_typescript_code
    assert_match "export type SendEmailRequestIn", generated_typescript_code
    assert_match "export type SendEmailRequestOut", generated_typescript_code
    assert_match "export type SendEmailResponseIn", generated_typescript_code
    assert_match "export type SendEmailResponseOut", generated_typescript_code
  end
end