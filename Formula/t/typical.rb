class Typical < Formula
  desc "Data interchange with algebraic data types"
  homepage "https:github.comstepchowfuntypical"
  url "https:github.comstepchowfuntypicalarchiverefstagsv0.12.0.tar.gz"
  sha256 "f469e5dc2934f48be2b068ae9f5ec6ef7e4e52915260034848a568870a41ad3c"
  license "MIT"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "765f1430fc39f3a64fe7147c9ba1423e92aac5e65c8c65784a62104a0205d1be"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "f4938d716f558a8c00ca8386b4fa70582f57ef71db416890552e3bb89de38cc6"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "ef1e56ec88509df6623aa8c9a87391e8bbe3a95bab942a8717501fbcf3c1f5ff"
    sha256 cellar: :any_skip_relocation, sonoma:         "1714af00d49b1bc0546d69c9a882c0bba2550562bef13e6e89dd84b2e11ecbcb"
    sha256 cellar: :any_skip_relocation, ventura:        "65f9d47b8f0b5ef8c5c52467ae30e9f587945a5015c9edc0ffcd6ecf68f2b40b"
    sha256 cellar: :any_skip_relocation, monterey:       "6a8f0b03735873bbfe852bc697e1a980de2a0b045d818a38125b96c39b59bc97"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "2c7702d554123a71455e8eeebe53503650ccd9c12160759baf31782361e3e7c3"
  end

  depends_on "rust" => :build

  def install
    system "cargo", "install", *std_cargo_args
  end

  test do
    (testpath"types.t").write <<~EOS
      struct SendEmailRequest {
          to: String = 0
          subject: String = 1
          body: String = 2
      }

      choice SendEmailResponse {
          success = 0
          error: String = 1
      }
    EOS

    assert_empty shell_output("#{bin}typical generate types.t --rust types.rs --typescript types.ts")

    generated_rust_code = (testpath"types.rs").read
    generated_typescript_code = (testpath"types.ts").read

    assert_match " This file was automatically generated by Typical", generated_rust_code
    assert_match "pub struct SendEmailRequestIn", generated_rust_code
    assert_match "pub struct SendEmailRequestOut", generated_rust_code
    assert_match "pub enum SendEmailResponseIn", generated_rust_code
    assert_match "pub enum SendEmailResponseOut", generated_rust_code
    assert_match " This file was automatically generated by Typical", generated_typescript_code
    assert_match "export type SendEmailRequestIn", generated_typescript_code
    assert_match "export type SendEmailRequestOut", generated_typescript_code
    assert_match "export type SendEmailResponseIn", generated_typescript_code
    assert_match "export type SendEmailResponseOut", generated_typescript_code
  end
end