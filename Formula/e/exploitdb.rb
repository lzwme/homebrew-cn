class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-17",
      revision: "7ebfc36557170876b95b6574c59bf0be43d64d03"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "0970a16fe94e296dd95d74d493c0869f52a060bbb24aa070059d122d56f31536"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "f9195716da6f2ba398877f98aeb6e621d268fa4dcf4e4a0f5917bd12c6829f41"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "c6093e7231e9faba7839970af9f742dd5faae5b0e57c99438dcbab69b8e8635a"
    sha256 cellar: :any_skip_relocation, sonoma:        "0604b7cf9768382356c4b9c4d9dd5da45c2d88d4b67f4e9f03185a1c04660418"
    sha256 cellar: :any_skip_relocation, ventura:       "8ec24ecb8d2ce9ba7fed003c32b95cc5eb6b540f5d63f2d5f0f5537dd2b4bf87"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "1d28e3e5afbdd071a7c28d96a8788fc78b52c2bcef89fe8ade2bc92312dba10c"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "5e2221ce000ecba4bf92e906a6de97641ea1ba2b18c7305cf3f8fc6f9f0c60a8"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end