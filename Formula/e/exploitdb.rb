class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-03-28",
      revision: "15b516383f67e143a29a40b3ed7ad5dac871ba94"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "219afae1149046b818bc8d8657832e8aa665ddfa20e8e4c1b0a94f8582ea6c8b"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "8060b8b548a9fc74cf29acdc4a3156790fb73919c4a1b677fb823c1954f4b8d4"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "05b00652ff0ddf7e026f2515078ffc25d577f6e99e96e95082eab637f45aac30"
    sha256 cellar: :any_skip_relocation, sonoma:        "00fde7681325e9d399dd485fbfff3c4f93c2806130256ad75602fbf89bb4c8ba"
    sha256 cellar: :any_skip_relocation, ventura:       "9cf38b84ee842a3c37256de3e5785dc7d4dae7884d61ab2c691aa5c7d7e1d36e"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "d814a15e2f2a47152496cdf8f48422712c3ae8f59f8cff2dee2a975e2ba56ea6"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "9607e2a7f405502b74d6ef7d22f6cd0e0c90955a527e88a6ebfb0ce6c7e8173d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end