class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-10",
      revision: "937420d384e929e2a9bf1dbcc3cef926f0307696"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "03dad914ac16a7fb0836d31d4788a0d2e96e472310f750160503170d7109133d"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "695a7bb765fdf9db9970221432212a00672daa91e599a86c06c8aec619ca4ea5"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6067927fa9d97003f0e72658506e8f1ab284dd4e1ab8abff10c972e0d1609106"
    sha256 cellar: :any_skip_relocation, sonoma:         "17f8256d8a27c04812c0f167f939333c7a5949682cb9a732245852ed92e4679b"
    sha256 cellar: :any_skip_relocation, ventura:        "6dc69d556ef7d00be1dec109db1199406508523ecbffbfdcc8022f374a49dc90"
    sha256 cellar: :any_skip_relocation, monterey:       "ca3064b63e8cc4512520d6628b2ff2d7403f4784b8d3c4cd6392fbea626c0f0b"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "bd7910fd38731846de3fb16aed57d38c109959ad6b7505b5d5bcef2a4b2c3265"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end