class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-12-07",
      revision: "baedefe44ce8e22505ee00213c17ea4774e30faf"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "7afccba06423963265e610a7ebf2a59ece7236b8d238f0987e66bd9f18269cf9"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "d2133b1a60ed8c919b8907ead4ad6542fd80a6d810ed4dca61f5af449ce26242"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "41e6043428207d67be9b687aca367490d775e6a83fbecfb03da6a1ddb1ef7ccd"
    sha256 cellar: :any_skip_relocation, sonoma:         "dfa7630493e3dd86dc5d8ee9c912b8ecc9615684f259d1afaeb61335397db964"
    sha256 cellar: :any_skip_relocation, ventura:        "d7e5931f2194905169e0919afaa7208ef718862628c8b87a348e0856a4d0e1a7"
    sha256 cellar: :any_skip_relocation, monterey:       "3a4e6cd251a4e48fc4b64b0fc711da3eeecfdfe878172f76255129bacf452fc9"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "5fbb3ffae0d7ad66d89b69a76fc9ffc72a309762e40200f3566809853d49a404"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end