class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-02-27",
      revision: "9734fcef1e58aeb06cb8911e2e2b0c7804d7c984"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "f89c0521283a091ada89edf9f25da22afdde49a6ec1bfc096d546178a8e4db1a"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "e7bcbabed207e1ca8c92279ce3d4ec9c1ba674c6b5cbaaa92665dd85adebba93"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "04c56cea8f5117fa6cad6645d0e630e931a9e137b38db58d1d0340b1710b3800"
    sha256 cellar: :any_skip_relocation, sonoma:         "82ca2b76fd1da16a5dd5de64d0cad585b7cf46abe917602b90ab6b4b0d8ba336"
    sha256 cellar: :any_skip_relocation, ventura:        "278c1a0a3232b0dd4f244e0282abfec63e1693878240939000b4b17bd403b6df"
    sha256 cellar: :any_skip_relocation, monterey:       "e4ecf694d7bd159db55d83a1c829c67ed60c1d5793ef04ce01b5063c2f8aa7b5"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "7444c38af46f8d9caab53dea344906411328c3bd6ae0cd828764afc71013e60b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end