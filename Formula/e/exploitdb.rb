class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-06-10",
      revision: "2edde6c15951da303486696ab6db34451d505659"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "288e24fa8d6a2ae724ec5af567be8e9c4447575af609e9da462b76209393a191"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "1496f8794fd929cf74a952711429458473feb85d1ba838573860bc8444722a10"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "8cfc4fe41008e7227211417bb62e6dcd667fb5ae5f244448b2e7a95a229e7fdb"
    sha256 cellar: :any_skip_relocation, sonoma:        "350f3e817a628a627966a2f7ba00c964c40077fa526de7966a212cb9b8579706"
    sha256 cellar: :any_skip_relocation, ventura:       "f528c2ad8c15f7f7fc3966ca2c4d109cfe6824719bc6ed6aaa002ff3957b148c"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "588c7bcfc920a28094b94617062db7e99da85246cdb7d6821c57a7014b0cede3"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "30b7583bac71d8fc252538ea4260bd33aca119a83639e3a2b5436afafab7bb1d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end