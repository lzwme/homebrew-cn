class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-10-14",
      revision: "53fc63f69b2fde74ea86cf1bf5d9e6987b1df9eb"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "7c70641c3d96bb93b30960f53a59364c9db996578610a36cf4911ace8b9b4a76"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "44b854b80edcf7d6adea88f1abbc7da6d67a8533f24404a52aad7c515a7098f8"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "addb11111edf1df2fb5481aca54270fecc3a96262c6e8480aee05c92f521c0f2"
    sha256 cellar: :any_skip_relocation, sonoma:         "9369743e38490380f9b223a92a5163120d46d1e2590d4354e012ec9b2ae3e652"
    sha256 cellar: :any_skip_relocation, ventura:        "69fea1c7c4d3acb8bfe1a653f7f4293920dd8bb598a075019cf8579abdd6117a"
    sha256 cellar: :any_skip_relocation, monterey:       "25b01fe6fb8c675edaecb6acd5682c141e01fd399208e4bccf2225a57dc3f42c"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b04f95b8d3220372a1efc628449d68a8f1e56ec0203899f362820911366eb46c"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end