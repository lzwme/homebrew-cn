class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-05-22",
      revision: "6d030b37a60c2264902be54e42b1015714b64265"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "f57d5b1b26a42d4c3dd693892e77546eebed16c41c0d6c3201a5c6f479fda6e7"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "143841313d67c44336a9ff23c5e2db8ada188608501e6c24034c0c81b35c0692"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "7396902f0047600a18e7941dbec558affef0ed15d819b84dc279c6a352535781"
    sha256 cellar: :any_skip_relocation, sonoma:        "ee7f6ebce21597c37245958c80bf8442b186a6fa219cd10460698fbde0c0c49a"
    sha256 cellar: :any_skip_relocation, ventura:       "8eba386104ccb417dde268b5e875aa1fc76fc85d2a6dc7529cb8109267d48679"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "ef34db047d903fe86d4f940281c5ae8d35f99cc243068f7e68cd1d1cf07adf34"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "88c5c1d3388faad0dd9e8126a7fe628ad2e0dfaec38fdd7a26db9670d5e92b24"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end