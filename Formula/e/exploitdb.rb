class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-16",
      revision: "b905517ca9a636d1a51cc974fde60ba9812fc8a4"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "bdc326411b15ff6657e1a531b77d5153aa1d87ac487ac43e3fa9f700a91f9e80"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "6f50aae73de543db1d0c74ab26973e53411b4116e35b3976cb656c9cff5cd70e"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "9b4cbbd061ee0c3fd603a3557d69353931ded0194b297c27a3df797feedc2c7b"
    sha256 cellar: :any_skip_relocation, sonoma:        "354eb40d5dd128b0017c980f6956e3dd0d2920c4adb7dd9ee994b8c8542d8544"
    sha256 cellar: :any_skip_relocation, ventura:       "4c3a4bbb148ab779c6179241fa94990364a33f4dd21a18d16b9cfbaf94f72fae"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "f76be0643dbdc6fe228f8964a90134b3a262715ad3b352692d1db7c090657284"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "1428fe93ee80506c8cfc9d9190aa65402e5283d27409f7423b768d956149e262"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end