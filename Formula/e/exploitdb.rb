class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-03-22",
      revision: "c185b4853b4568124c3e945bf495dfcc8fa7c13d"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "b711e4be550f7faa78e52b6e88611ed1dd584a1482f06a09c9b7226da22ad0dd"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "219a925a7e29c0757dbe2a16a7a7a5d300a829efd8550a1cc0077e026e4e9863"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "005a661a659b2386d7fcde03ec6e98e9d0e136aaa3492501ca7cf8ab0292fbc8"
    sha256 cellar: :any_skip_relocation, sonoma:        "6a0bd2352dd4b2b3642023f1d261038a64a40b621a0753f30d22ed83c45173c7"
    sha256 cellar: :any_skip_relocation, ventura:       "a875ebb5d165b972f578dec6fa380699715e788c9c612af85f55283c4e4322d8"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "b8c67502e383662ba95d1488d2b219d537821fe7de8be6a95dbcce3babab38c1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "3eaf119f3f06ce2353cc7645e2d3315103e30d57f9a4e72f990abcd7742b1d48"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end