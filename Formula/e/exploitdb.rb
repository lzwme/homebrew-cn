class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-04-04",
      revision: "a06b0db78ddd1a004881470f08a3081689772628"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "0711b5047ea9c6b3f744a3a5d11d52311f9aa0cca6a0d6286390f750220285df"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "96e974790dd6b776fbbfb8be87e84539b6037e95f3a9be4e4fd884b78bda5731"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "ce5caf1d243d2d54f6d3192785d2f99038da615db62bed0d87cfb911276d96f3"
    sha256 cellar: :any_skip_relocation, sonoma:         "e9bd43b3a3b6f0092aff467610bcd060ea8a9cdb41bbb4e657f0aa81562f0d1c"
    sha256 cellar: :any_skip_relocation, ventura:        "91291a081db0ddf81fbfa6bd8a3528bc7f5f366d85e6b0f7d8843fe3f566e894"
    sha256 cellar: :any_skip_relocation, monterey:       "b96cc3e51bb887ca43dbe5b4f0a6a18dec96945e1d6b02ae255cab09fcce8882"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "fb684da6b4ae27513956ad224116003f840f5afe096aa60ce489e1ee7ba9551b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end