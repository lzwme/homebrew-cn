class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-02-17",
      revision: "411b6755b3ca29b3695e00756986941ae746c191"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "c5660438ea1bb4c73227c3daa16f687d4b7ba41d8cb55e164187b5ef5214f9e8"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "a115ae75a5677fc2fa2a3a75b59ad2ac206df6c78c1aef355d9a2dc8afb62068"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "35d8caa6252cf6a39dde04d194df1183f3910d3ef3bb223aa5885c6c2d1cec9f"
    sha256 cellar: :any_skip_relocation, sonoma:         "7ca695df8e133b354f43c5ffcb34973d6519ad5e41f9efa37be6d18e52ee2e69"
    sha256 cellar: :any_skip_relocation, ventura:        "42c79a6a15a0e2c34f9f197ae73c55d2a75ff59b88e1008c52f6d21178c7ff45"
    sha256 cellar: :any_skip_relocation, monterey:       "3a70eb846b7866b41e5470a3b24061b75d1692a790ee39f56a57d4650677397e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9ef42d24898994071cfc90b72703d41715dd2542401410646cc7549002e46e53"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end