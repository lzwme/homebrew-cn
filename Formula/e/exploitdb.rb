class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-05",
      revision: "f8c80e2b5d5701709f9991339f1aabc9e591c6f2"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "04f10904da7a41611952ee65f1174fa55b49517dca35c0255bfed97b65ff59f1"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "2b4ccd10e63981336de52312fbfc196d59db681b4a604f03059f40ffdabc844b"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "6bfbf636079669890bddc71bf3e9fa86c5159c3448b16f3986a91b57cd69ae75"
    sha256 cellar: :any_skip_relocation, sonoma:        "f188ade5ca36eabc3604cf07bcb99efe43656e92c1e9659b566b42478e56bcb0"
    sha256 cellar: :any_skip_relocation, ventura:       "2319e53ea4edfdd0821ecb08bb3c08a2a19d9bbe2909e9095716ceb822b9594c"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "31231430ab905beaa06312a641b4a84c36e57ef7a1ff04c522b4338dfb46cf32"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "fc122b3c0eb72caad254e446fdf434d3c16c72b8fc2718393eef9b61eebe3b87"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end