class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-06-01",
      revision: "3ac07794c9563bbcd799f8287bb5c37bea3f8fe7"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "eace5ef702f644fba2ae260d8a4482a78ca69e959bcb56929c1662932f771aca"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "ff3e69cd4180a4f00bc9793790a80ea80090b5a3cc2730d6282f4d489e984a3b"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "16fd70d1aba27df5c3024b194cefc7551e5ea40a40ae702ef148dea3522a3c1c"
    sha256 cellar: :any_skip_relocation, sonoma:         "c548279187bf87ba1796ff58d13b92d58543bf553cdadcad21822555dec2713f"
    sha256 cellar: :any_skip_relocation, ventura:        "721594dfdb38457761db9454866a338bb1d41e37fd91f4bc0d4e3898cd2e8fa8"
    sha256 cellar: :any_skip_relocation, monterey:       "d7bdc9e3df27d564664d3b480978d4b3c9ddd79cb2980fcf741b015df1fb35de"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "ab18cb661dbf9f49442e98436a14982d4460457324aacaea3482ce177f9ad9fc"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end