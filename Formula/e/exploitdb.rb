class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-09-12",
      revision: "db6fc602bf1e2c532f850f103b5966aa4662c69a"
  version "2023-09-12"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "4faeb7dcf2f4e056bd5bb627fd85354e783d49b490aadfdc37a45bdbdf48471a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "8f631b963f9114ba3614d06e1243d8b5ad325ea61ddff0240a844c17ea3f5a35"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "dc117bdb179a70ffa327421a693c79fab9038d41c6a06b915323cf67d9d3a116"
    sha256 cellar: :any_skip_relocation, ventura:        "65c32c10d592d6e75626de42157eade0d29578da0bfb2398843519ff1a878f9b"
    sha256 cellar: :any_skip_relocation, monterey:       "4a19351dfe7367918c2a9f7c035dd6a6ca4f3c90d423065a1c8f5f979a6c0f76"
    sha256 cellar: :any_skip_relocation, big_sur:        "b99238572a2df2280b325cfd529949fd5293aa2713b91bf0b1c154ae8f6ebcbe"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "735a86be562feaf0d4ba9c157405f40f50cf4c447b9de32be1792b7d1a94427d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end