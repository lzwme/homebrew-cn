class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-04-03",
      revision: "a44e138f786dbf36d3aff5d5eee8ac56bcd21e89"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "e3d64d8066e02514796a8fa29716337f4c9ea45b5bc7f5b71ab0aef78a1aab2d"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "07733279cd42fe7e3af25992fa6a00e885363eea6818f9275a148c892e437e14"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "c826cd89cedbc91d9f526b5eeb583f086feaeb3152a1a7a7a8b6d9aa083df6ae"
    sha256 cellar: :any_skip_relocation, sonoma:         "5090574b5d49a85067fe05ef2c4417b84321bcb082a9fa4faa6cd97395107933"
    sha256 cellar: :any_skip_relocation, ventura:        "f5cfff7fd5d0a0a6898bbfc6ff8f7ef626d1ed4ebbfaea9b591818cb51bb2739"
    sha256 cellar: :any_skip_relocation, monterey:       "db3a1caa67eafccc31c8f7a1aeac9d43718312fd343192c22cbf93696e2b6450"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "ea0da8b6244eb83d47300c7510517696b0bf3793d5bf37b31e9205c8e85f0880"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end