class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-04-09",
      revision: "034fafa3fd901a545cbace600e9ae997cf4d144a"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "81a6ba68b5fd015f506406a2f1c95941b3864a9adeaee586f4113fe4672c0c49"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "4e88bdc0f28326abc6cb127936217f67a7dbee6ae91ce10ed2fecf344f1d83e9"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "e7541c99ba910a0235185ea70c88b506978f744eca256c4dc89be9efa085679d"
    sha256 cellar: :any_skip_relocation, sonoma:         "33e3955ffa00df9ea438184819b62febd4b466a21dbd71d1c77024f96f87a09c"
    sha256 cellar: :any_skip_relocation, ventura:        "08adac6110327a224f2d11fb12a54b3b8a9ac196df98348c2d35389397bb9d01"
    sha256 cellar: :any_skip_relocation, monterey:       "c6e53d5931176e830363dd9ae520cb1f3d9402a04c69506bd91b781129f999e5"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "1edabebde487a6332be21d45dbdc0b94c370a311b581ab0d5561d92f0a0f07d4"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end