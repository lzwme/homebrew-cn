class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-07-29",
      revision: "78eb91c445bf25b563ad6a719c5c5a8051e8df4d"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "bcff75c2bd8e047d634be5a6e6b9b06cc10ace28ad0114cf38c77b3ab7413fa6"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "d5179233eaa22eb447e30adcc80ee2b7b231c89cb3fe7cf67206de38507dc89c"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "dee455a02d2d788acfa527bc7c2d5422727089ecbfe0291acfd5e71baa80c91f"
    sha256 cellar: :any_skip_relocation, sonoma:        "bd4331dbf4401d98f7655a97224a838002d591347a02e33389d8a0108abf78f0"
    sha256 cellar: :any_skip_relocation, ventura:       "742a45e6ed63d88fed5e1ed6c711f8f1fa9d4e8c3a85baf5a40e1a31789deeca"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "44f18ed0bc8d0ca4641cdd6729ecf1ab54a7d0b77b379a9c31b7b84d710462c8"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "53e7a6d322173cc2727359ed821e83a0a22ec79743c5ed1948fc13d6ce8410fd"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end