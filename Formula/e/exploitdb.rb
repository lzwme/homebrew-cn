class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-20",
      revision: "71bfc9b6c5b3eccfbf6a9509bc385b2155f4a6c4"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "b6b1e794888abb5e696973dadfed6988c15b469fe0f302c5254c3a809899e8ce"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "b59e1773cef406e82dc885f8bc1541c5758453cc6c49c355b38018fc4896c515"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "ed930d1243db56460b7a92d9cb2fcf28417d607876f0afb8343f9b29dc862a9e"
    sha256 cellar: :any_skip_relocation, sonoma:        "836ca23c5003f3a9dfdf651e6d3d785ab4bbed147df1213056475cf42b109f1a"
    sha256 cellar: :any_skip_relocation, ventura:       "6a10f83158324da40de7add625ed7e6f1bd215c5d35e7ee8f5dbae0e5a1df190"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "5931b1caac141584d492d234e4f8cbf14edb0ae722f026f8552a9c8d0ce24992"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "e5735e022afd123022790848edd803bd2865641af74d1b76b174f09ff1a56511"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end