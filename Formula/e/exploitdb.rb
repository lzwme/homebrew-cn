class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-03-29",
      revision: "353059c64d6612b9f4361bb203cedfcd3ab351b4"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "fb217d887ef8ee6332004f538c55b09ad3fbe74741dafc227811c3b50473ac8d"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "aa19eed6bc57a935371f3465557746289a6652eb162350511dd4b4f537be20b6"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "1c627337aac2b286d9eec5e1c91938a8c12e7d0874aec0f08128439614a8a4cc"
    sha256 cellar: :any_skip_relocation, sonoma:        "64ea1e163225e1da617b36bd4cda9ca0d63a9a2a113dc8130305f9e7c2fcd225"
    sha256 cellar: :any_skip_relocation, ventura:       "2ba42ea16c40cfc55517f36c3dfa8ec6e39a443d5e23f1755705b525abb2b822"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "c293200c8b2bf8d1dd340acfdc490c7a0ad712b0b2253696f71bd1b6f552355d"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "89d1d74eba673e1a74b1a1fd69df44c5564b993cab7063c742846ea21e4d758f"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end