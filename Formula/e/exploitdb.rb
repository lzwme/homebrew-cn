class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-09-18",
      revision: "983a0a603b3ba73375232c8d4674c20439d3b080"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_tahoe:   "75cba8696cb063f2cf32697b0c28d7c0558c60120b0a217d02cebfdf03e57a15"
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "4fe6970682d06a60454fea0fce06dac6b3866faa20ada72e23b830bb9befb167"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "7869291610f0473385a5e901e55eaca97ce9e3dbb623d6ea0e1d46dccb5f3f79"
    sha256 cellar: :any_skip_relocation, sonoma:        "4d0fe1f93c6d17790f1de4c46afaf6f963a6d500f49fa9a398262a6ec94cb8c6"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "f2ad244136e964505033144dddc8239cbfe70a87dc36fa6bdf7b4f28b6ccc62d"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "028c6705f60b905c7cf276dabca400da3ac5731f67dd4d16239f9bf302f1be29"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end