class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-02-28",
      revision: "c1bcfc63471d90fcaecea6b7d011faedd031cc7f"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "90a42c6d299bdd2334018a99662f921df073b82d1b3171bfaad335a7acfd4ff7"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "f3df8dd7fd886e431125845c5a1acbc165a1a1419dd03e02a45e48746b749271"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "8a61f7d01738f99c6919f9a7fbbbade5065db1037f6578a4b25670f2f0cc2c22"
    sha256 cellar: :any_skip_relocation, sonoma:         "c968d0c0eb6b624948111755be736df625dc8532aa216ac9cd7b6c78e02fb4b4"
    sha256 cellar: :any_skip_relocation, ventura:        "759aec456fecda51eb8882594058c8450933735775225fbcf1db2cf928469010"
    sha256 cellar: :any_skip_relocation, monterey:       "ef453db17270dbf23f106bae33ff1edfb5b219cdcbf528bf6f2ae050e226feee"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "33a01dc406de7c5a1ebe293b05c57f6aada9533e3bc891dc419f23a7b579aa73"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end