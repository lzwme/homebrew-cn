class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-07-05",
      revision: "388e822220c370438738bb983e78284b686226a2"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "40cf022b19c984fd6de8ecaa73aefe4f421c3164b62c6cdeb06aaaf4e5f10c6b"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "050dbb3c937eed65124c413ffff3960c4f2a2a84c0feae665a70f312f8fddc44"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "446dab9608bd704e08f36efd7cd97d85b704d9276a4656ab9a8bd871592fadef"
    sha256 cellar: :any_skip_relocation, sonoma:         "8ba924aa6e75dec4255d4438bc831ad28441a585ed152fca8b173a0a2e6319dc"
    sha256 cellar: :any_skip_relocation, ventura:        "74c92af31d48d47e40ba2e7ff78ef5b7404f2468669bb0eb78aca314e09aaa8d"
    sha256 cellar: :any_skip_relocation, monterey:       "4cacc75c44e3f52abfecd9e00745545c0f349b87e5c6ef5ea3642aed1700bcab"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "67da97de5fba189737bf317d8cfc5e088e6c35712cdec68db3fd039d0997ee52"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end