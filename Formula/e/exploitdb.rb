class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-10-30",
      revision: "84026b0ad169f8bf1bf1bccbacb2197a5947c516"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_tahoe:   "0e69416f8e4460e413b8ffcae5bee2536d255397ab0aefb9c653d8266dcc8c33"
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "c54e3b117641b66aeeef06f2436bb1323948be404284d8cc8db7e9517494f8c3"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "df0e3d38d1f5979f4cc2f0952f85c69137c959d4d6e8403775b3443ed162bbcc"
    sha256 cellar: :any_skip_relocation, sonoma:        "140a8c2a54114d0e13289c7f8a5f7c8fd3c597e412c26f3f9cfc6b1bcd48de95"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "aee071432a3632110d92560828250c2975d3edb599b26b130b5497602efd5d03"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "9bbf0c6f9366a7d465ec39be4741453004b011dc00f54ac743dfc99ada35e5da"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end