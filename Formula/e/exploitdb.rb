class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-12",
      revision: "b165516b1b2ab318884a40f1ce5a3252e563737f"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "521036547065f5e32268ce55336aeeb5c4dc0506be69374f567f4c987a8dfd1b"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "acbc9e4f6b3c2b3ba0076ea8aa01fc48134f7fba1941e14dc1c20f938d3e8b0b"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "844f0c6fced19316f7a8cbe2a1a34d5529db3bc7211f9af8855c74147373e99b"
    sha256 cellar: :any_skip_relocation, sonoma:        "3c92f737c064e05597e74408eb2d6bfabb7fdc1e930e9fadeeae3e1212183c47"
    sha256 cellar: :any_skip_relocation, ventura:       "cf84eff2a4ee36cb77a6ab3d51654073be95846172a32343e6d84c6db7ad2a48"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "5d0faede15d2506a5442ff1501d1adc8980fa40ae3c9e836cf39717809993812"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "1c26cfc413506a5e3c8a2daf0d52ec52a23c5f200b166538ceb17b500bcb5995"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end