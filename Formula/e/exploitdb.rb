class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-04-20",
      revision: "4ab159b6a8b2cef31dafc620af7a85df5da2a56b"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "96daf6926619d614d3a07a9f31a6a50647e61dafa0c70c87764188cb5cc2e548"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "40dae92c8dd8ee9244901383f170a565221ddd6b12e8a6cb0c9c3cbf9438c61d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "f690d90c1da76cf6b1e62a026e9de5457486ea38b845786aad447caaed745610"
    sha256 cellar: :any_skip_relocation, sonoma:         "53db462ebfc4eeca863a28dc926acf1342ae76946583efa6e0e940ff0c907d75"
    sha256 cellar: :any_skip_relocation, ventura:        "faa1df9412fa5823d1c39aacd2c95757c7fba4873fb4ea5658e42ea67bddb32f"
    sha256 cellar: :any_skip_relocation, monterey:       "443d474e27d20172a63802ee77a79efc8249cc418d8bcb50fa449e2751bfa3b1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "26fb17c71218ee0639ec7d8d8b4ec173eaf4d67bbe3efcff023b5411e9ce09c9"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end