class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-12-13",
      revision: "07b04761c2cdf89674bec4d51dfccde87588e59b"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "05469ec5e77bd83348f27e65493c804cd5b745b6bf5b546f0d91021181c85436"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "30de6b276597c728f6b12c7125c6e8861d2fd4bbd2717b079e121b3ad77abdbd"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "d6558523b5e58565886de547ea82a164f3e848d52934bb092d4d9a495f780078"
    sha256 cellar: :any_skip_relocation, sonoma:         "981739a2a9a08e31bac380ef1b323f9c1e05764a1cf959f6c1f2813715687528"
    sha256 cellar: :any_skip_relocation, ventura:        "809e26a533459941c8ac877ea6fe79d9dd27095bc0e07249678fd7447f5439e2"
    sha256 cellar: :any_skip_relocation, monterey:       "a1788507c7c987c54e049562934302a57337772a299e4b2bc90901d8cfa354c6"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "72aadbf1479faa0fc2b284f2ff2ef70e7084be4df6db23e858ba173093c99847"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end