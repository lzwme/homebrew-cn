class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-03-19",
      revision: "b42ec1de46be5cc18240febecea94aa06f26d02f"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "fef7635899dc97e754b5c6826f79d4d5a2f4c082cf581cbbcd57afaaf2237d7b"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "1d1eb4b6edde20ffab79867199851355dce2703d41a61f594a41ad84aa3f286f"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "3e23ffcf080d243b0872165eeb05bc14c62bdcaf87c18aa3efd9d925ec0908ea"
    sha256 cellar: :any_skip_relocation, sonoma:        "dbb142ab4ef21543e0b299a31edda68eea9207c066da2599a1d328f76514ce2c"
    sha256 cellar: :any_skip_relocation, ventura:       "e564eeb5ee8eedb5654917b630ce091d9362de0115d2792cd597cdf51bb982c8"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "5458fc7eb4ae29ebb9120d07b28230f8af1909412242294311fb0a1b86287c13"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end