class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-04-14",
      revision: "b59144d74e6dc1db0f8f7d04499d707e68635a30"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "08a940dcb6ac4b9e317ef5704f201ff776f0b2a99f2e6ee91e4b06ab0aea84e7"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "8268383fc969116ed32d84a8f1858474119e8cbadb187e71a5fd2576207e3f8f"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "cb761a642cd98468ad6ceaf66e209c56cfb3cad023cfe9c78be036f841342452"
    sha256 cellar: :any_skip_relocation, sonoma:         "e33d57bf6957e43bee85ed55036350646f7a44538fea18822da629a17360b685"
    sha256 cellar: :any_skip_relocation, ventura:        "3eafe4b1b1b05e91b1fea1cde1d76b91348c05ae9420b560749e871a14f64072"
    sha256 cellar: :any_skip_relocation, monterey:       "cf9b9e6ed4e6c0c0460e79b8351db0f983315d401b07d8a857f07295d6568fd8"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "8499bbf9e9152da38e115f07ee267d77b82731db7e9acd6cb77fbb8388efad36"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end