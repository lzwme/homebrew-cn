class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-03-26",
      revision: "c9576b1787677223c8a12898573fbbb3e12719f9"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "85c42a0243477336ce421412ca0ef311eb447030b8d55f9aac44fbecd2ec500d"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "e6a4d503459535aea75571fb2235f25ffdd1c7d03231119c0306ab5a69551733"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "7bf640622152448030519dfc4bb0a0926f792fdb8b3351abbe196b2adc628edb"
    sha256 cellar: :any_skip_relocation, sonoma:         "efe46c350fad40653cbe86233f35f850f3b0a1aa4945d8a30187a291d1939947"
    sha256 cellar: :any_skip_relocation, ventura:        "ba6d774f6ccb4a47191ba325d4c8e73a21484d38af99756d95832750ecb7fdae"
    sha256 cellar: :any_skip_relocation, monterey:       "460751b1924e902da435ab1df3d062e6d16b95a5a50503af693ac5b002b88868"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "e2f3bd4025abb36a5b78bc4fa09f166614e26dd24cd76b3758b32615ddc36f6b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end