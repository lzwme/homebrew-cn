class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-03-29",
      revision: "e791587e41c5fe7b1fd56192356c8f12ad5dcf67"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "ef6667c5404556b8e61dc786751e6ec1509c3b6cad7c500fbe4d68213edaed16"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "10c37358b8696603efb31b55deadbf2bcb0e3e64bffd2df1bc33f58d09bf286e"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "890e503149046a4b900d5790dbb35ab2584493ab3aacd42d460062762f45ddff"
    sha256 cellar: :any_skip_relocation, sonoma:         "892d796aff9c8315bd8205073b8a59d3ee24d964b2609df1c1be841d2f22a3e9"
    sha256 cellar: :any_skip_relocation, ventura:        "9eda4172ddb46dd4271ab706a3be1df388d52dbce45d4a49384515cf73e253a5"
    sha256 cellar: :any_skip_relocation, monterey:       "d2a84080a37fa51dcd0f7e0d55171a71b22c6c6cf6ee2ea1b0f0cffb84a1ddfa"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "6b8b113dd6ae3b51ba108c21d4cea3e2b2f9ec3fd9ddba02f758385d0a1f2a4f"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end