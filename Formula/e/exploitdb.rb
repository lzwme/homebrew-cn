class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-08-25",
      revision: "76d99ff06ef169fbf2362deedeff769113473bdc"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "db2113bdf6d5c2a395efbff8993ddbb325e3d6952a66720ce106675182173071"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "5b112e553452d9eb69f8037b1ef3513ad16e60b5758e317f11ddfe3db62d479c"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "7f38bc7d229d12e82f472f5cbe0a35614dde46f79a1b5c1b2121ce5cd38d3378"
    sha256 cellar: :any_skip_relocation, sonoma:         "c68f06e86a1b5fdac5eb867d31f274e41498da7f94545a02c384ae61a6539bfa"
    sha256 cellar: :any_skip_relocation, ventura:        "4a63e5caa324de9cfd2331685ad28ff6ec42f42ea852124c911cca079f7d6745"
    sha256 cellar: :any_skip_relocation, monterey:       "8629255887bc5ef2185666ce8fc77fd867dbc55d066b9f238edd00e9bc5529b1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "dc6680151ee3b4ba88ac7cfb7afa54f85a2a19aaee3875440b29e933467c47a6"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end