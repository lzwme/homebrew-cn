class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-15",
      revision: "0f3d104e83b3e12a601a527cb08cd32acd2ea639"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "385eb4050baffcbf8ea14ec92e413fdf3751ee5afc74754a407bf10135f8ea28"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "09f74bb9e8d0deb137fc60b764f1dc2e4c493254e05db875195e041bf8855a5c"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "2cfeb7655a5a4037a7d4269f97865277d79bd3377d8c980e18d0975db415ce85"
    sha256 cellar: :any_skip_relocation, sonoma:        "d3b29a317180d59a7fb8bd443a35153cad02a4ee9d512caa6eeb0a407eac7bcf"
    sha256 cellar: :any_skip_relocation, ventura:       "8bd29b0165cda8cd14e96b17ec371c0683f2d0113eec456b2cddb83ea0452380"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "fba58c488a85bd8f685965746be4fd376062b178f57636a5f19e33bd5f360413"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "9781b4c814aee39f549d63806ecaf3e0105728757df71c156acab887ca96b550"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end