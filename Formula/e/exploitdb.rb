class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-03-13",
      revision: "98f7ce18e2d03bed952907af36e6a4fbd718b435"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "ad111a46b99ee62b209037738df7fab6761ca1000ee2fd21d7d1091710893687"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "7590f8b5a3a40222cdca7f3fe7cb990b0540b6dc031580526304b6f81fcc59f2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "b2fd8b434d4a9acdd72acf9d8a451719f0fd17ae0835432dfb4305c1ce0ed17c"
    sha256 cellar: :any_skip_relocation, sonoma:         "6ced499f5eadcc15ebf39f516e32ec691d4c031412d6af8f7a3b6bd9f273991e"
    sha256 cellar: :any_skip_relocation, ventura:        "0926ccd680a6df9969351e922b42cce3b8805ca73073db44b837df186ec3d5ed"
    sha256 cellar: :any_skip_relocation, monterey:       "eae63f07f5cb20b7237c97519d686e7e44d320cb572468ebd1c013bc3f0e303e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "6605c923a3f021983d53589906c049a90ee6be27f7d403dff20c100dc4da06c0"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end