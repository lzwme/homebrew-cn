class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-04-08",
      revision: "a8420434d298eca275a1f879447807cd519b6dfa"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "a46bdb340e2c62d59ff954a696c5be6e7fefd250c5bb93e72b667bf58d825555"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "85d9af4aebee246d86ae88459567b74a8e1e4ac873015cff492244bf3ef434fb"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "fbce7f7241904d828d9df5552d886c74bcf3265386b898e5fc13afb741e5c525"
    sha256 cellar: :any_skip_relocation, sonoma:        "f3d0168b13360ee8cfad015aa85c1e80aa109eef81a885ed63b819499100e8d0"
    sha256 cellar: :any_skip_relocation, ventura:       "e20aa5b380d9ac698973fa58d8af8a0bea005cdc7389c1c6a75bc7e552015484"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "cfd7dbaca74044b66e3d1f3bbd3b88235f8fa043f237f70b249e5a08d298501a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "57e9ab895f499ff2fb1aad77da26e53a3883158c9440ad569bff85dd47204725"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end