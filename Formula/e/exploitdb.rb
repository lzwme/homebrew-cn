class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-02-22",
      revision: "624b24bca9ed3065bba62a5c8ab02acfb47b71d0"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "51e6d66b7457f079477cf702d3a839ff1c94741ce99cb7aa19a4759ee9688bbf"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2c4fa25fcd4bcfa4288e53cd2fa01b5320195445cb894b27938b93edad32b541"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "7703ac7babad7eb3bdf276ea65460205706d57e6757a2df896d14cf7c13c9671"
    sha256 cellar: :any_skip_relocation, sonoma:         "e8cf61affbaeb47cef718e26ea86e0e21b7e1ac4150bba09f497a96e88c0cb59"
    sha256 cellar: :any_skip_relocation, ventura:        "47f66143d6ff16e8d40b64e4ad6221d33a142da6ab10459935a6e8921be38609"
    sha256 cellar: :any_skip_relocation, monterey:       "7b3befd9896e1792274f8a563363d28b09d082ec97ecc623d590ecf6bdcbbec5"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "8aad8c8628af467aa200690e8ba8a60ac41fe2a56046c35b57419db7d9197bdd"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end