class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-02",
      revision: "ea7fd161a3e347593eced25f19a7e1d0f99886dc"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "1632a70f6a0f208721dfa7f39cb4371c589ce7e8c8b799277dc74ce5e06524e2"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "892bd7d326bb2fb73d0a502a68f5b3e2c04f242817e1d6ca178822ed7227dd7a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "b4df91250d4aa8b1078e313f8f328c204fdf4761836b454618c6498df5d9993a"
    sha256 cellar: :any_skip_relocation, sonoma:         "7f391c5457b4ac58151272620f9e10e0d20066e843f1ab4ebbea76d9169590c8"
    sha256 cellar: :any_skip_relocation, ventura:        "800408e375dad4843d3186de7f102cd62eceb80e099fb1e8238aa152696fd1e1"
    sha256 cellar: :any_skip_relocation, monterey:       "89d7cbde42eafc3e66e7e62146f4f4c4f6f2f6c7a69833b85d1e95e79d20007d"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "82948417390f19423a1cb8b69beca85e22c6644f9214b0bfa9b2a07109e822fa"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end