class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-28",
      revision: "bde3836027a32d9c56a8589a5ee34b9d7502fe2e"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "36b415c932283c002019141b84103dce534233bba4cf0ef18193c670858d6751"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "8ee05fe22493ef955f704824c8544d04584b79db393b43bc4783907b17d0324d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "83fb74379c130fcb7bf2a68aad64a0546aad14ea6200e88aec9b8e85388400d9"
    sha256 cellar: :any_skip_relocation, sonoma:         "e8c2060ccd1a2de878280990d353833f692ae710b6ebfc9924e1c1fa4ad45a88"
    sha256 cellar: :any_skip_relocation, ventura:        "04893e41bd64a836a7ec96464afe771be08da090e2b4d5071f1bf2a29b351123"
    sha256 cellar: :any_skip_relocation, monterey:       "596ef0711ea11f2f20b790371312bff5265ba0a82108f30d761401ebeab5babb"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "588eb3dd44745a673072ea6847d4c4291c34ebfa57d94d4ce171aac35ea37e49"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end