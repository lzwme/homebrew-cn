class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-05-26",
      revision: "d69eaacef80e5091a4524d76233f7841067029c7"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "5f80d964971f44f7483a5242899cb46561c4ac26a48561d46beda6509fb75c0a"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "ccb2e65dc513f019645e2c965940bbf53e634ba3ce778a2b3fcd1ce0f021c4b3"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "ba469028f683c16ad8459660617a9dfa27e4e4e4020fccdc2f20172ba7521806"
    sha256 cellar: :any_skip_relocation, sonoma:        "7fd993ac8dc6b0169c7180341e044af07223d8fa0a0345319680343cdaabd881"
    sha256 cellar: :any_skip_relocation, ventura:       "9004f63c5be9d41a1d3e410e7a9161014921ee993419428e317013fea1d345be"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "a0ff9ea9d24e0921d383523c64d7d7a2b7c0adf0f35491681d9b9626c998c44f"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "99bb982d069bb65b294eb066ca22b52cace2dcc63abaaf18f9a3e075f39ce790"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end