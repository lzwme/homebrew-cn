class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-03-23",
      revision: "26a991fc284115de86ae52c8f302a005597342b1"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "c77298f371ad092dafd541793c62b1851e704d87f4fcc922ad70a218872c9d91"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2abd27dd7c93bb88a398b882d8f239dffeca8e963be28e22f7e7dfa1d234e05f"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6eb4f3bfd3ced957cf3d5e22520169b48b9087cae2945d79a472043877aeeb9b"
    sha256 cellar: :any_skip_relocation, sonoma:         "6bf62c42188db5ce24c2f090f8d1c2ba1960faebdc92c306ad67aa64c6eeb3de"
    sha256 cellar: :any_skip_relocation, ventura:        "0c7b3534245fc1441cfef44fd415876dc167d96c4ebf48c730817f2d70d24cb2"
    sha256 cellar: :any_skip_relocation, monterey:       "5be871d2aa1c0cc0081703f429f07f17f59efce1ee05eb8999f5454d3c16c141"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "1eeab52be85f8269928ad9543dc84baa795dddfd65694e59f031d0571411f377"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end