class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-09-02",
      revision: "ac7d3615444de404877d677c894f9d958d0ae899"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_tahoe:   "879418f994a5b82e5a3096d28d658dcae2f17f67ffe8e8c0c3bfff727e5e4602"
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "dac7de2f951a5a41f27a19220d0b0c6855b403863f01dc898327c77a0f7df549"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "15995cca9b68de60ee63939f91071dd0f9bc5f705e0fc3c39449c17fa3618f8f"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "e558fa8d471500ad211f5ba13bf1d63901997f9b160ba3221b10baf8e9b5b068"
    sha256 cellar: :any_skip_relocation, sonoma:        "802cdcbce528af502e7d17c8e352ec4bda53c4a0acd86102d4b7b5fe392eabbf"
    sha256 cellar: :any_skip_relocation, ventura:       "d43d26dd2d6c97de4f68c56c17056cde018363acdbc7e4c44faf9e2313a2f5ac"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "ff16b717755a738d3962645ebc0124cb5aaf4509e1b113c302d3d66369442e9a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "62c920bff6bd727038adb51b9a2795d1b64419550bb97ed7f0e55f66c821839f"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end