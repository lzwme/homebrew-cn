class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-08-24",
      revision: "809d81619e7de523c33f1757a06a759295b0f917"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "28d6bc78a0fad367e2e12dad9309382d63381a2f90b4451f571249b3482c0d9f"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "65e214690a144d7e2a63c32b8eda291345e0d959254026c00a630359cce69f23"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "dc51e197775ec0f79d3a0d09cf873e725a6354eee4098a1cf6f93b8527f2d8cc"
    sha256 cellar: :any_skip_relocation, sonoma:         "696739e36b02c5db00a823e2bd575f5ef4b987a1cd5666120477a2e571ef379e"
    sha256 cellar: :any_skip_relocation, ventura:        "de8b29a90438f293ba31f03f3ef96d079883b20e4c5028d43f8049b33d30ba97"
    sha256 cellar: :any_skip_relocation, monterey:       "a8c94226b7551144bcab840b58f51ce7db048c73bc36362bb878d23126af3ee1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "825fa84c7c376f529479f55ddc3fd12026fc03c92b9285fc863b2960a806d38e"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end