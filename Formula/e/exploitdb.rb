class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-09",
      revision: "43a5e18260bd1df97b77269767439644343484a2"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "73381070b1cc0d6e6f20ccd5de409213d1173af44c0c90dd1f355e1963667ca7"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "814a598b73fb810910e18f169858cad25fdf423061c5a3d0eea74a44466c5bd5"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "598da88cce54b9951acdad4c560ec6bb9cdfbf7e76f50e08f5f1e293546eddb7"
    sha256 cellar: :any_skip_relocation, sonoma:         "f08441b679923406de32cbf930757b0947221e1fd85d7400ca0ed4ad7632958c"
    sha256 cellar: :any_skip_relocation, ventura:        "b59c46587d3632fbcdd788805d3254be3851ad86de3bede7add0e3552362b873"
    sha256 cellar: :any_skip_relocation, monterey:       "9bc350fd22ec6f79c7944f4aa291a2c35d3b235e289bf48ba223b07770c0dc04"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "695e12d5285c68b85e690c0fca73cae61567bc418b06a8805df89ff4431bf045"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end