class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-07-17",
      revision: "08e51ef2f932f69915d98c0c1bba22c4cf303108"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "8e9f5fba88bc6e20a569fb6c6964a88122c3ae41c731a4ba3003b8144ee90228"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "656644b55aa344570e77429d7db3a68d58b90cc68b6e5c9ad210238dcccd915c"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "21b3bd7c0ca52a98dcfbcc225214c869978e865b46ae950774c06c38a23e1a9e"
    sha256 cellar: :any_skip_relocation, sonoma:        "a3f07a60e310e3de362aa43094057aae656c1ca3a4758e4d3e49935c47f13507"
    sha256 cellar: :any_skip_relocation, ventura:       "9156986e68bcfd1b76e0cfd29681d340810e28aaea5e26823639b345d86f1a5c"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "7012be0250d4da50ed09851ead571e97a6bf513dbcaf8ef94d175ead3d961e02"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "82aeefeed2367454259aaf73e857ea1c1edb7553363e044392efbb28c0303927"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end