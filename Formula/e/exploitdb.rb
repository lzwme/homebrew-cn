class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-12-15",
      revision: "5ae67f58b90e5dd20f46ae7760f369b56e5b84fa"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "50a5e0f8af185b502b58ad147afb3956f02f762a4b3d1e82cb3659c9e126b84b"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "a4786345db2fd93e7d3dd6a2fcdcd0b3de329133741a18bf9da7ff09db9705fd"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "521ba794c239bd2e776bff0bc2c0affaddd86e8e5fc42134b61f6d4720064855"
    sha256 cellar: :any_skip_relocation, sonoma:         "841f08268f37d4d02f9766e68840cacad266925e2daddd5ab2a4985b58f7bf40"
    sha256 cellar: :any_skip_relocation, ventura:        "c5213e5566dd7bdca001b4633701f21615e91d33d4037dc0547ae7e85e3d0658"
    sha256 cellar: :any_skip_relocation, monterey:       "afcf25e5dec14a42d055a7917fd7c7fb28ba6eef80d183d330a9e14886a7bfd1"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "788674ed66c7653b8bf841c2909fdf807d6a6bb22ea8299aa8d3ce49ba4c0b95"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end