class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-02-06",
      revision: "0c65b881bae76cfb2287b359deb6df38f2512077"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "fddd5b5e22ebbd3cd63c6ba27bf921ad3b545e8b8b407962732f695724152b46"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2ee236964b20439b8c72e98b8381b0ec56b7dd82b4e5f708ba1c023bc1c49731"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "8cf5003c3fbdf7e529bcd62a3d38fa8e8c4063ad9df3fcd1bb7071060d2098a2"
    sha256 cellar: :any_skip_relocation, sonoma:         "6473b6034493550f288a8ea4225c55a08b29f01536913d7c06080c8e41bbe58e"
    sha256 cellar: :any_skip_relocation, ventura:        "29b15bd85410ab211c997189f238a94dbb992c9de1a31e8da548b8cf60484f34"
    sha256 cellar: :any_skip_relocation, monterey:       "56c0f9ab8368356123d471ede070147779ddbcdc9775f0de5f04f3385a575d8e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "98bd52e46ac1ee64a1d4e130e2819a84e6b7f36917304a6b67afabcd7253c191"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end