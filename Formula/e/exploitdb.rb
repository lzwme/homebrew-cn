class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-05-01",
      revision: "cc6d742d6140030ab9806c7c564439c714c79728"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "abcb2b3ef9f7c633f95a4c18cc6a3923757eef1a3cbd5e94ecd17a3df51fb27a"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "1887019a58c9944a2ec774239c9fed5f9109b6848386c13af7b45ca74445c322"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "7853b8576823b1dd9f6f908a2344dba004944a8f3cf5b17e0b52aaaf11e3f87e"
    sha256 cellar: :any_skip_relocation, sonoma:        "922c47037e5abff371706751a366d31dbcbe36a68edb5e7b677e2995bb012e51"
    sha256 cellar: :any_skip_relocation, ventura:       "4dfc28492e653e53d1aba1bcba03d4b44fe76919146b7508e28895a4bcdbb565"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "b5ebac7bd28312e91288403678077cdc9f71e0d9b3774f9d7fe504551d8c2fba"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "5bc9224dab7ee726f0db92791137d19e98b8634657ea815215979a4a3979283d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end