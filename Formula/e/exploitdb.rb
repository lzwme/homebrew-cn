class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-25",
      revision: "617a6b403621d0a96010260776a5f0bdd54e0f4b"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "39e65d13134b1d75ddcb75594e9b3eb155d35e1ab6ec1f510525a2fd094eaa86"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "9053f62b37c58c800ed3e76e921ea0f4c238aa96b3f786f5108923b9a7223a9a"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "0745d6a158648985671f3217d165695ffff121e9fa9b19c55148f25119261175"
    sha256 cellar: :any_skip_relocation, sonoma:         "369b784d28888a67af2de567766acdd97d58a866df797798151d66a09e1f04af"
    sha256 cellar: :any_skip_relocation, ventura:        "d1513077e664e4e77df86c5ca732f90cf8ff52115cec5923ee4f40ecae73156f"
    sha256 cellar: :any_skip_relocation, monterey:       "cbe8c52e7da8f1dbf9e7a4bbfef9a9c9873155d5b5a9abf6b9f6f9bfe6f4fb8d"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "07a74ecd7b6afdd3163d883737ebe553286f827d444d14429f5db0b9ad03228b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end