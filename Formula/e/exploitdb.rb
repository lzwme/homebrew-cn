class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-08-04",
      revision: "2c2486dfa39f5843715a0c1a9b777bdfbe081e2b"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "1d171156c1d662c8afe8cccba88ed388f4c5f794fd53b9ec0ffaf845e6915471"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "8307578228d451e69943b5d867017a2aab0efc86a862b291c757e3c2cd452268"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "75499a79f4a48c2f7333342771e59d556ce075e8d12068d2bf6f054f4af2d168"
    sha256 cellar: :any_skip_relocation, sonoma:        "f51cd8dd31ff0f38fd2f9268773cc2f09532488edc8f2cea4d3ddf2611e45b38"
    sha256 cellar: :any_skip_relocation, ventura:       "28558463e47f8401752cc0a84d8f9c567f8cecbe111be9e3d36aee144c0bd4a5"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "6a1425391466578dad3a7a59e56a215a18d2d540004eb98e1d63d73f5ec47cb7"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "7ee108694543f427057a62e983aedb47442547ac750cf27c1bb430d1079ad325"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end