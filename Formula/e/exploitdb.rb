class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-03-30",
      revision: "6805102b8a527244846c8ffe6454085915cc7542"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "a9de1db906c6b27db5aeb602c6cc5ca071bd165363cd7983fdfa1cccc2cd8212"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "64f443e9a0856b1d1643495b60b9e90f70bf0ef629b578562add713a5f3ebe87"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "28120d5943b364a737ae926e849de8b7a226266d67b72185d1abb707f6d1ab31"
    sha256 cellar: :any_skip_relocation, sonoma:        "f646d7101643c1dda0c53aaabbddb25877695e270ae127bcc2f5c9c3555097a9"
    sha256 cellar: :any_skip_relocation, ventura:       "096962fb5f1472ffc9c66d7b104564dcf4455e37d69d5b2ea091e5cb264b02bc"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "0deae7b3bc9eb86a22a02acfad3909432e66d3590b9036c8c4f5bf5b5f222dcf"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "9c40d13fdeafd7fab72796cf4b67ed3aae95e9dfde76ba14495b74489344bf26"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end