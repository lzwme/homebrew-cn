class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-07-02",
      revision: "ec1496737698629b17228c7478e579d7a453ad7f"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "8c70775674136655eff1fb61b0a14b370333a297d8a740d3a38e70600a868a4b"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "6b156042d4b8955bd7b0f0422f4423db53dcbf6499a85deb67b2238e1266529e"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "f3adfd3d0e7a34af5de1c3bfdef7a8fc55125e0a39f907bb671830674eedb166"
    sha256 cellar: :any_skip_relocation, sonoma:         "b3d65ff1f59146fba9dd704b4fd23d22edbf7229dbdb15783b0560b75bf39c3b"
    sha256 cellar: :any_skip_relocation, ventura:        "6db8cf13f69f0033b75f88c62d320b3261311e54b1625e816e26f6833f891004"
    sha256 cellar: :any_skip_relocation, monterey:       "add2a09c27fc4df59e21d76a35e3f055209dd83a92279c9090db311668d79d00"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "9d532eb61f21fe71db6b23dc54b1ba881baee988bd0ae55eeac4ed1805a1d5fe"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end