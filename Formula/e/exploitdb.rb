class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-06-08",
      revision: "a99f08beda9c9769ad22305f7f53132f1261e2f0"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "707d85dda0a658d02646cad80fb27e70dac08a04f5c6c460b942072b9c11325d"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "028ef7b2dd5108ff2ba8bd04572412f5bf45f971eee444b4e16a439d6a0045a1"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "2de0d1e73a06282579310306314fc919a117f28975885635805a09d2ce904ff3"
    sha256 cellar: :any_skip_relocation, sonoma:         "e2391e4009a3a4f1642248c4130af4eb81dd1b3dcd46db9f7dd06c71ce2f9076"
    sha256 cellar: :any_skip_relocation, ventura:        "8097b7601b2e2fac02aafd160620f5b26eb4cf8af418302714f19471481628e8"
    sha256 cellar: :any_skip_relocation, monterey:       "74f7e44207bb59eea7a22adaa634e7cbf67d4b4a73d41b4b36c072c4c0f48d08"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "0efafdff6d9ca6a71a1ab07c29eac628fa21aae8677b5e878ddf9ba0e27c8215"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end