class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-05-19",
      revision: "8bc45b368af71018b3b9d493d9a42fb3c8eae8f6"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "70c7ae1118598f5aa5d2049f93171acd727ec0cdee7061df9680591785c68cf0"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "03b6bb225766814e8827f2fbca6dff8c355865710416b74b7ad2951b82e14834"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "d8da4ba9485e45f77059147ad939b90a7dcd77f9c3108b4326450c21afc45134"
    sha256 cellar: :any_skip_relocation, sonoma:        "b3d66631385347e5f8fc7629ca2a29b8168f0328cdf5b1d9103ff0310f804665"
    sha256 cellar: :any_skip_relocation, ventura:       "a7c3b1d10b1e2240ac9117b9ce1b151e2f27f91520e90d8722fe73172fa9a963"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "106b02ca22d3a04bfe8cf0cfb5757a4964e6d0aa3a67b1b272ee07d4e9595345"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "e4694f5411687574db8c8a262d119c314dac03aaaa9f02671a71cbde4caca959"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end