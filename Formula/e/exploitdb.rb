class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-03",
      revision: "5b9acfe03d22778ef4e33cb8160329816492ebfb"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "887854ecce59db39a72f3306a2f3d99a9a4ea98a57704c38bcb52898249fa382"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "2b48d3c0b9c44bcdc1381f954d92e9a332707efe1999090f0bf3a1f1815eed2d"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "00df034dd4e6e4a8fb46e8bf78fa916c61943795316229a74ea3c797613e79ab"
    sha256 cellar: :any_skip_relocation, sonoma:         "e02d0135da982c6eb542016de20e6ba68156e3552dc9ae6cf04c0f48b33295fd"
    sha256 cellar: :any_skip_relocation, ventura:        "023971e892d0cc800414d07547990404b61318e3f62197b745c9a8b7ccef80da"
    sha256 cellar: :any_skip_relocation, monterey:       "c6f274229d37f8e535c7b7fbbdfb3b659e04f3ccf8ca66d4fba884caacff6340"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "7508c4ef378e79d1b8f560f3674cbae4df024277e708901324a9392892b4069b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end