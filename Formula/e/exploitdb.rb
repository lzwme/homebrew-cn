class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-11-21",
      revision: "d66aada84d9db6ee03e0fc34edf30eba2f3bfd5a"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "f27470b0f36163f2d9f466b0bdbe560a23f0590b24c9e7f35aeaae09818bb0b2"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "f1f279b29c6ae7fc5615746501c314f8218234b27f9a55f46eae27e9cc343567"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "d561041fd4ed04a3c75d090a5d16632159b9873c465d16162fc19ed3b185577f"
    sha256 cellar: :any_skip_relocation, sonoma:         "123a897c406938c9b2294ac2ed37732f2209506b62398b899bd01612054a7e0e"
    sha256 cellar: :any_skip_relocation, ventura:        "36167f9461373a9f4dbee906330550715ac5fc51ea83068f574dc45f29d0828b"
    sha256 cellar: :any_skip_relocation, monterey:       "bba84f1d717ed63a905a223b4fc423db904dbb43049c4ec9b473dea30d028521"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "2960eef339a49fcf147c7efb2261cab8a74452bfa03c587605771518f7628c79"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end