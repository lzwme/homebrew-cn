class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2025-05-30",
      revision: "c3b152279e29d5427af997886003f9873a9caf95"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sequoia: "d47b286dd97669ed43365a3e5b8f21031c83f7546ac91a6ea1747471032d0e1d"
    sha256 cellar: :any_skip_relocation, arm64_sonoma:  "8474d578696a2e391d459984bca188d1533b3f53adf3099b3c10ce357c47b23c"
    sha256 cellar: :any_skip_relocation, arm64_ventura: "606e4a950a2fe40359911a203d382f569cf01bbcbb1d30f679feb7bc0b2da516"
    sha256 cellar: :any_skip_relocation, sonoma:        "e7e206b507c0632b112df26058e0bdd9ca2d6ccfb87aebe2e3f63e568c7b6e9e"
    sha256 cellar: :any_skip_relocation, ventura:       "1ea9dde4b2d28d7088f3da7c9af5eb40409bb5f67073f021f2a86a36b82aa10b"
    sha256 cellar: :any_skip_relocation, arm64_linux:   "975b9c5b7d63e551fcbd6f00bbb15c9c0913a4af8653ac10c38690d2d0bd4805"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "3aa39458d01558bfd74f190993aaf3b4432aaa4b2de868175fc82c6cfcdf99f9"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system bin/"searchsploit", "sendpage"
  end
end