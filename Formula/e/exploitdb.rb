class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-10-31",
      revision: "75cbb282d962e26488371db72a023a321593a5cf"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "8de2d81c9ae4b22f155d40e21323f546b683da6fd71c560478749c74c7235016"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "fc5db3c96fbc032d5054b3cca94f811f6b787236715f025581f9ff5559c445ad"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "79b780363a0bcd98b40e81268b34d793878a4897d4f4057b701fcca69d866ffb"
    sha256 cellar: :any_skip_relocation, sonoma:         "9a5a8b3d5f08f3ac58eca5cc605c7a8013888c354e6d01e7c005eb9e92057cd1"
    sha256 cellar: :any_skip_relocation, ventura:        "1730adb38ef9b87eb5191d8425e5b17c4d10de63b3eeabd6e9509c7f46e09e32"
    sha256 cellar: :any_skip_relocation, monterey:       "cb201d1d41609b111bc8495a08ebea21f837ff07e00129032023cc37d2c82a19"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "5a23fdbe725fb31b968e7ce4fbc6fb8b683bbdb12eaed305e07b3b15aa9cf8ec"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end