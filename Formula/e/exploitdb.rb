class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-07-03",
      revision: "859e322e5cce8f24d187c20a76d9990fb1427e36"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "8330079ab9c41085283ce952cc91ae404878903a6ea381003772b1ea8d06bed6"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "facee1d9a810db8383db73e58d9af0149af0e9c1235cbba204ee8935047f3b9f"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "3f204643155dfe3ac0314fff9f91eb540db27dd568bd85a7e437d89ae2c6b617"
    sha256 cellar: :any_skip_relocation, sonoma:         "adbbf4833fb327ac04eacd0fe97c2a8eb604d5db16d68219bb4b3802ecf9dd2e"
    sha256 cellar: :any_skip_relocation, ventura:        "764607a0a00b72ee1dfd88a120ca97fcab372e6af8fdcce27ca2d2861c4bab9f"
    sha256 cellar: :any_skip_relocation, monterey:       "ddccfac0159d62394be4afb238365dc891cb1c1b826c02ff39b7a562d1e9b42a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "ab9584943b864a0165cae44338da879d4d538cf3bc85e5b00616d1cf459730fc"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end