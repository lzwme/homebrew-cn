class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2024-03-01",
      revision: "d0ee8ba723492ddd5ee1206226e16a9451143d3b"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_sonoma:   "01d0cc9d41464b4df004131d63827b7e565e7ad67168aff6d3f7af142bbf369c"
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "ee94d3e7a0abad6b98a2fff2e257b7570f1bed9d0bd3e3ac13a694b82cad5cc2"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "7a12186c39d886a201d7ba4116ffd97d4bfc26486ef2ea24ec3e8e976b951c20"
    sha256 cellar: :any_skip_relocation, sonoma:         "2f9c1e4360a15be7ce5b97296377a66c2ac12ad401ab47660814fa3bf475afc1"
    sha256 cellar: :any_skip_relocation, ventura:        "a113c561138a5d5f768b902cbb8c1e32998d1db5d91b2c6dcff9e7a813aef5ee"
    sha256 cellar: :any_skip_relocation, monterey:       "d0b8a1831e62ad786d4223696ff5747d798f4604fbf985e5ece740f5edc2e53e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "da56ddb39f84b1473bc57c76337b46064a27b780ff864c34fa6f6663237ffde5"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end